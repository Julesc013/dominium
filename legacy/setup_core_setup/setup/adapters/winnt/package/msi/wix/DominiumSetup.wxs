<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" Name="Dominium Setup" Language="1033" Version="0.0.0.0" Manufacturer="Dominium"
           UpgradeCode="{00000000-0000-0000-0000-000000000000}">
    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />

    <!-- MSI properties map user choices to setup request fields. -->
    <Property Id="DSK_OPERATION" Value="install" />
    <Property Id="DSK_SCOPE" Value="system" />
    <Property Id="DSK_INSTALL_ROOT" Value="[ProgramFilesFolder]Dominium" />
    <Property Id="DSK_COMPONENTS" Value="" />
    <Property Id="DSK_EXCLUDE_COMPONENTS" Value="" />
    <Property Id="DSK_FRONTEND_ID" Value="dominium-setup-windows-msi" />
    <Property Id="DSK_REQUEST_PATH" Value="[TempFolder]install_request.tlv" />
    <Property Id="DSK_PLAN_PATH" Value="[TempFolder]install_plan.tlv" />
    <Property Id="DSK_AUDIT_PATH" Value="[TempFolder]setup_audit.tlv" />
    <Property Id="DSK_STATE_PATH" Value="[TempFolder]installed_state.tlv" />
    <Property Id="DSK_JOURNAL_PATH" Value="[TempFolder]job_journal.tlv" />

    <!-- Custom action should only invoke setup, never implement install logic. -->
    <CustomAction Id="InvokeSetup"
                  Directory="INSTALLDIR"
                  ExeCommand="dominium-setup.exe request make --manifest &quot;[#ManifestTLV]&quot; --op [DSK_OPERATION] --scope [DSK_SCOPE] --ui-mode gui --root &quot;[DSK_INSTALL_ROOT]&quot; --components &quot;[DSK_COMPONENTS]&quot; --exclude &quot;[DSK_EXCLUDE_COMPONENTS]&quot; --frontend-id &quot;[DSK_FRONTEND_ID]&quot; --out-request &quot;[DSK_REQUEST_PATH]&quot; && dominium-setup.exe plan --manifest &quot;[#ManifestTLV]&quot; --request &quot;[DSK_REQUEST_PATH]&quot; --out-plan &quot;[DSK_PLAN_PATH]&quot; && dominium-setup.exe apply --plan &quot;[DSK_PLAN_PATH]&quot; --out-state &quot;[DSK_STATE_PATH]&quot; --out-audit &quot;[DSK_AUDIT_PATH]&quot; --out-journal &quot;[DSK_JOURNAL_PATH]&quot;"
                  Execute="deferred"
                  Return="check"
                  Impersonate="no" />

    <InstallExecuteSequence>
      <Custom Action="InvokeSetup" After="InstallFinalize">NOT Installed</Custom>
    </InstallExecuteSequence>
  </Product>
</Wix>
