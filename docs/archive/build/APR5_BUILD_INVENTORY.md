# ARCHIVED: APR5 Build Inventory

Archived: point-in-time build inventory.
Reason: APR inventory snapshot; current build policy supersedes it.
Superseded by:
- `docs/build/CI_MATRIX.md`
- `docs/build/TOOLCHAIN_MODEL.md`
- `docs/build/ARTIFACT_IDENTITY_AND_METADATA.md`
Still useful: background on early build inventory.

# APR5 Build Inventory

## Build system
- CMake top-level `CMakeLists.txt` drives all products; defaults to C89/C++98.
- Configure-time guardrails:
  - Windows requires MSVC (`cl.exe`) unless projection builds.
  - macOS requires Xcode generator unless projection builds.
  - Linux requires GCC unless projection builds.
- Global build number is read from `.dominium_build_number`; `dom_update_build_number`
  refreshes generated headers without bumping, while `dom_bump_build_number` (or `testx_all`)
  performs the gated increment after tests.
- Build identity is embedded through `cmake/config_base.h.in`:
  `DOM_BUILD_ID`, `DOM_GIT_HASH`, `DOM_TOOLCHAIN_ID`.
- Baseline header hygiene is enforced by `cmake/BaselineHeaderCheck.cmake`.

## CMake presets / toolchains
- `CMakePresets.json` defines:
  - MSVC, MSYS2 (UCRT64), Linux GCC, macOS Xcode presets.
  - Baseline/modern presets (C89/C++98 with optional accel).
  - IDE projection presets with explicit toolchain tiers and OS floors.
- Toolchain descriptor inputs already exist for projections:
  `DOM_TOOLCHAIN_TIER`, `DOM_TARGET_OS_FAMILY`, `DOM_TARGET_OS_MIN`,
  `DOM_TARGET_ARCH`, `DOM_LANG_MODE`, `DOM_SDK_PIN`, `DOM_CRT_POLICY`.
- Additional toolchain files live under `cmake/toolchains/` (arch-only stubs).

## Packaging / dist metadata
- Dist layout is defined in `cmake/dominium_dist.cmake` via `dist_init`.
- Dist metadata is generated by `dist_meta` target
  (`cmake/dominium_dist_meta.cmake`) and writes:
  `dist/meta/{dist.json,targets.json,files.json,build.txt,ver.txt,hash.txt,rules.txt}`.
- Packaging targets are enabled via `DOMINIUM_ENABLE_PACKAGING`
  and `scripts/packaging` subdirectory.

## CI / quality checks
- GitHub Actions: `.github/workflows/ci.yml`.
- Jobs:
  - repo-sanity (IDE quarantine, tree sanity, UI shell purity, ABI boundaries)
  - projection-sanity (legacy IDE projection regenerations)
  - docs-sanity
  - build-test matrix (Windows soft/null, Linux soft/null, macOS soft)
  - reproducible-build (Release)
  - portable-packages (zip/tgz for win/linux/mac)
- Additional guardrails in repo:
  - `scripts/verify_includes_sanity.py`
  - `scripts/verify_abi_boundaries.py`
  - `setup/packages/scripts/check_layers.py`

## Platform floors (declared)
- OS floors are explicitly specified in projection presets:
  - Windows: win98, nt4, winxp, win10_1507, win11.
  - macOS: system7 (classic), 10.4 (macOS X).
  - Linux: glibc_2.2, glibc_2.17.
- CRT policy is declared in projections via `DOM_CRT_POLICY`
  (e.g., `static:/MT`, `dynamic:glibc`, `dynamic:macos`).
- Mainline builds do not set a floor unless a projection preset is used.
