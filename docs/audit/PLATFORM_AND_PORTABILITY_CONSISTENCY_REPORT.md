Status: DERIVED
Last Reviewed: 2026-02-09
Supersedes: none
Superseded By: none

# Platform And Portability Consistency Report

## Scope

Audit target: platform identity, dist path canon, portable execution contract,
and RepoX/TestX enforcement alignment.

## Changes Applied

- Canonical platform IDs defined and documented in
  `docs/distribution/PLATFORM_ID_CANON.md`.
- Dist doctrine documented in `docs/distribution/DIST_PLATFORM_DOCTRINE.md`.
- Portable testing contract documented in `docs/dev/PORTABLE_TESTING.md`.
- Platform registry expanded to canonical namespace in
  `data/registries/platform_registry.json`.
- Dist token generation updated to `macosx` and canonical package roots in:
  - `CMakeLists.txt`
  - `cmake/dominium_dist.cmake`
  - `cmake/dominium_dist_meta.cmake`
- Alias directories removed from `dist/pkg`:
  - removed `dist/pkg/win`
  - removed `dist/pkg/mac`
- RepoX enforcement added:
  - `INV-PLATFORM-ID-CANONICAL`
  - `INV-DIST-SYS-DERIVED`
  - `INV-MODE-BACKEND-SELECTION`
  - `INV-PORTABLE-RUN-CONTRACT`
- TestX coverage added:
  - `tests/distribution/platform_portability_consistency_tests.py`
  - registered in `tests/distribution/CMakeLists.txt`
- Portable smoke scripts now execute from random CWD:
  - `tools/distribution/setup_install_smoke.py`
  - `tools/distribution/launcher_run_smoke.py`

## Directory Structure Findings

- No root `shared_ui_win32/` directory exists in repository head.
- UI backend implementation path is `libs/ui_backends/win32/` (canonical module path).
- Build target name `shared_ui_win32` is generated by CMake target naming and
  is not a root directory.

## Enforcement Outcome

Final gate run status:

- RepoX: PASS
  - `python scripts/ci/check_repox_rules.py --repo-root .`
- Strict engine/game build: PASS
  - `cmake --build out/build/vs2026/verify --config Debug --target domino_engine dominium_game`
- Full TestX: PASS
  - `cmake --build out/build/vs2026/verify --config Debug --target testx_all`
- UI bind freshness: PASS
  - `dist/sys/winnt/x64/bin/tools/tool_ui_bind.exe --repo-root . --check`
