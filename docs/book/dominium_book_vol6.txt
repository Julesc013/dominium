Next step: **Proceed to Volume 6.x ‚Äî Launcher, Build System, Distribution Architecture** upon confirmation.
You said:
Proceed
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
Ready to generate Volume 6.x.
Before I output it, I must lock in the structure because Volume 6 is large and foundational.
You have two valid structural formats, and the choice affects all future volumes (7.x UI, 8.x Modding, 9.x Toolchain, 10.x Portability, etc.).
Below are the options.

CHOOSE VOLUME 6 STRUCTURE
A ‚Äî Monolithic Volume 6 (all in one massive document)
Content included in a single block:
6.1 Launcher Architecture
6.2 Binary Packaging
6.3 Multi-Executable Bundles (Win/Mac/Linux)
6.4 Platform Detection
6.5 Renderer Selection at Launch
6.6 Mod & DLC Loader Integration
6.7 Steam/GOG/Portal Adapter Integration
6.8 Sandbox modes (headless, devkit, editor)
6.9 Legacy Platform Support Strategy
6.10 Data Directories & Portable Mode
6.11 Deployment Targets (Digital, Physical)
6.12 Auto-Updates (optional, offline-safe)
6.13 Diagnostic Tools
6.14 Crash-Safe & Recovery-Safe Launcher Flow
Pros:
Single cohesive reference
Accurate cross-sectional picture
Useful for a final ‚ÄúMaster Document‚Äù
Cons:
Extremely large
Harder to revise individual subsections later

B ‚Äî Modular 6.x Series (6.1, 6.2, 6.3, ...) ‚Äî like Volume 5.6
Split into precise, self-contained volumes:
6.1 ‚Äî Launcher Core & UI Model
Design philosophy
UI layers
offline/online integration
flow diagrams
6.2 ‚Äî Build Targets & Executables
Windows (2000‚Äì11) executables
macOS (10.6‚Äìnewest) executables
Linux
Future (Win9x, DOS, etc.) executables
Headless server binary
Editor binary
Devkit binary
6.3 ‚Äî Packaging the Full Bundle
Single-package layout
Multi-executable bundling
Retro/legacy fallback binaries
Compression/installer rules
Physical CD/DVD build rules
6.4 ‚Äî Platform Detection & Capability Matrix
OS / CPU / GPU detection
Renderer selection
Fallback logic
Low-end mode activation
6.5 ‚Äî Mod Loader & DLC Loader at Launch
dpak scanning
dependency validation
version pinning
conflict handling
safe-mode boot
6.6 ‚Äî Portal / Workshop Integration
auto-sync rules
download queue
offline fallback
cross-service behaviour
6.7 ‚Äî Security, Integrity, Sandboxing
checksum validation
mod safety
sandboxing rules
crash recovery
launch isolation
6.8 ‚Äî Developer Mode & Toolchain Integration
devkit
editor
testing harness
debug launch options
6.9 ‚Äî Deployment & Distribution
Website downloads
Steam/GOG packaging
Physical Media
Patch system
Version pinning
Offline installers
Pros:
Modular
Future-proof
Easy to update one volume without regenerating all
Cons:
Larger total volume count
Slightly harder to reference without a unified index (we can produce one later)

Given the massive scope of Dominium, its long-term modding/toolchain ambitions, and your desire for precise subsystem separation‚Ä¶
Option B (Modular) is the natural choice unless you explicitly want one giant monolith.
But the final decision is yours.

Select A or B.
You said:
B
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
Acknowledged.
Proceeding with Volume 6.x as a modular series.
We now begin with:
VOLUME 6.1 ‚Äî LAUNCHER CORE & UI MODEL
Dominium Engine Spec ‚Äî Distribution & Execution Layer, Part 1
This is the master specification for how the launcher operates across all platforms, supports all rendering backends, integrates with identity tiers, handles offline and degraded modes, loads mods, and initializes the core simulation.
Below is the full document.

# VOLUME 6.1 ‚Äî LAUNCHER CORE & UI MODEL  
Dominium Engine Spec ‚Äî Distribution & Execution Layer, Part 1

Purpose: define the launcher architecture that selects platform, renderer, mode, universe, mods, and environment before engine startup.

---

# 0. DESIGN OBJECTIVES

1. **Single universal launcher** across Win2000‚ÄìWin11, macOS 10.6+, Linux, future Win9x/DOS ports.
2. **Zero required online services**.
3. **Strict separation:** launcher = non-simulation; engine = deterministic simulation.
4. **Support all renderers and platforms** (SDL1/SDL2, GL1/GL2, DX9/11/12, software-mode).
5. **Support headless servers, editor tools, devkit tools**.
6. **Unified mod manager**, local-first, external portal optional.
7. **Identity stack (Tier0‚Äì3)** integrated without DRM.
8. **Graceful offline degradation** (Volume 5.8f principles).
9. **Safe-mode**, crash recovery, log tools.
10. **No mandatory installer**; portable deployments supported.

---

# 1. LAUNCHER EXECUTABLES

The launcher exists in the package as one of these standard binaries:

- `dominium-launcher.exe`  (Windows)
- `DominiumLauncher.app`   (macOS)
- `dominium-launcher`      (Linux ELF)

Future binary stubs (Win9x, DOS) fall back to simpler text-based launchers.

Launcher responsibilities:

1. Detect environment  
2. Initialize identity stack  
3. Mount mod/DLC data packs  
4. Detect hardware / platform capabilities  
5. Build a Launch Configuration  
6. Spawn the appropriate engine executable

Launcher must never load engine DLLs or simulation code directly.

---

# 2. LAUNCHER INTERNAL LAYERS

[UI Layer]
‚Üì
[Launcher Core]
‚Üì
[Platform/Capability Scanner]
‚Üì
[Mod/DLC Loader]
‚Üì
[Identity Resolver]
‚Üì
[Launch Config Builder]
‚Üì
[Binary Dispatcher]

Descriptions below.

---

# 3. UI LAYER

UI uses **Level 1: 2D Vector Mode** (from Volume 5.3), ensuring:

- Runs on any system with basic raster output (Windows 2000 integrated gfx OK)
- No 3D acceleration needed
- Crisp scaling at any DPI
- Works on fallback legacy platforms (Win98) without major changes

UI Panels:

### 3.1 Home  
- Continue last universe  
- Create new universe  
- Load universe  
- Replay viewer  
- Tools (editor, devkit)  
- Settings  
- Mods  
- Exit  

### 3.2 Identity  
- Active tier  
- Switch profiles (Tier 1)  
- Link/unlink cloud account (Tier 2)  
- Link/unlink third-party services (Tier 3)  
- Privacy settings  

### 3.3 Universes  
- List of universes  
- Metadata  
- Mods required/active  
- Version pin  

### 3.4 Mods  
- Installed mods (local dpaks)  
- Enable/disable toggle  
- Load order view  
- Dependencies & conflicts  
- Portal/Workshop browser (if online and allowed)  

### 3.5 Settings  
- Graphics: renderer selection  
- Sound: backend selection  
- Input: remapping & profiles  
- Network: online/offline mode, retry interval  
- Ups/Fps limits (from Volume 2)  
- Security/sandboxing settings  
- Directories / portable mode  

### 3.6 Launch Panel  
Shows final launch config:

- Platform selected  
- Renderer  
- Mode (client / server / headless client / editor)  
- Identity tier  
- Mod list  
- Universe  
- UPS/FPS settings  

---

# 4. LAUNCHER CORE

Launcher Core performs non-UI logic:

startup() ‚Üí
load_config()
mount_core_dpaks()
read_identity_stack()
scan_platform()
scan_mods()
detect_capabilities()
build_launch_configuration()
hand off to dispatcher

Properties:

- Must be deterministic in behavior but does **not** influence engine determinism.
- Must not load game logic shared libraries.
- Must not access GPU for 3D rendering.
- Must survive external service failure (5.8f).

---

# 5. PLATFORM & CAPABILITY SCANNING

In cooperation with Volume 6.4.

### 5.1 OS Detection

Launcher identifies:

- OS family (Windows / Unix / macOS)  
- OS version  
- Subclass (XP/2k/9x)  
- CPU architecture  
- ABI limitations  
- Expected renderer compatibility  

### 5.2 GPU Capabilities

Checked via low-level native calls:

- OpenGL support  
- DX9/11 support  
- Shader model  
- Software renderer fallback  

### 5.3 Backend Priors

Depending on platform tier:

- Win2000‚ÄìXP ‚Üí DX9 / GL1 / software  
- Win7‚Äì11 ‚Üí DX11 / DX9 / GL2  
- macOS 10.6‚Äì10.13 ‚Üí GL2  
- macOS 10.14+ ‚Üí Metal via SDL2 support layer (future)  
- Linux ‚Üí GL2 / GL1 / software  
- Legacy ports ‚Üí SDL1 / software only  

### 5.4 Renderer Selection Precedence

User choice overrides auto, but auto chooses:

DX11 > DX9 > GL2 > GL1 > SDL2-Software > SDL1-Software

---

# 6. MOD & DLC LOADING

Launcher must mount content in the correct order:

base.dpak
interstellar.dpak # if installed
extras.dpak # if installed
mods_local/*
mods_workshop/*
mods_cloud/*

Rules:

- Never load content from the internet at startup.
- Workshop/Portal sync only runs in background after launcher init.
- Safe mode: load only base.dpak + interstellar.dpak.

Dependency solver produces a **Load Manifest**:

```json
{
  "dpaks": [
      "base",
      "interstellar",
      "extras",
      "mod.example.a",
      "mod.example.b"
  ],
  "order": ["base","mod.example.a","interstellar",...],
  "conflicts": [],
  "disabled": []
}
If conflicts exist ‚Üí show warning panel.
Launcher must allow:
‚ÄúStart anyway (unsafe mode)‚Äù
‚ÄúDisable conflicting mods‚Äù
‚ÄúEnter safe mode‚Äù

7. IDENTITY RESOLUTION (TIER 0‚Äì3)
Launcher must initialize all identity tiers (5.8e):
Load Tier 0
Load Tier 1 (selected profile)
Load Tier 2 (cloud)
Load Tier 3 (Steam/GOG/etc)
Respect offline mode and hardcore offline mode.
Publish:
IdentitySummary = {
    "active_tier": "Tier2",
    "display_name": "IsaacDominium",
    "avatar_seed": ...
}
Identity never enters the simulation core but is included in launch config metadata.

8. LAUNCH CONFIG BUILDER
Outputs a structured launch description:
{
  "engine_binary": "dominium-engine-dx11.exe",
  "platform": "windows",
  "mode": "client",
  "renderer": "dx11",
  "identity": IdentitySummary,
  "universe": "Greenfield",
  "mods": ["base","interstellar","mod.a"],
  "dlc": ["extras"],
  "ups_limit": 60,
  "fps_limit": 144,
  "window_mode": "borderless",
  "server": {
      "connect_to": null,
      "port": 42000
  },
  "log_level": "info"
}
The engine binary reads this JSON and starts the deterministic simulation.

9. BINARY DISPATCHER
Responsible for launching:
9.1 Engine Client
Example:
dominium-engine-dx11.exe --config launch_config.json
9.2 Headless Server
dominium-server.exe --config server_config.json
9.3 Editor
dominium-editor.exe --config editor_config.json
9.4 Devkit Tools
dominium-devkit.exe --script <path>
Dispatcher restricts itself to:
No shell injection
No environment inheritance unless required
No file transfers
Simple spawn + exit

10. CRASH RECOVERY
Launcher monitors engine exit code:
If clean ‚Üí return to launcher normally
If crash (non-zero exit) ‚Üí show crash dialog
Crash dialog shows:
Crash detected in renderer DX9
Would you like to:
(a) Relaunch with safe mode?
(b) Relaunch with software renderer?
(c) Open crash logs?
(d) Skip and return to launcher?
Crash logs stored under:
logs/<date>/...

11. DISTRIBUTION CHANNEL INTEGRATION
Launcher is the abstraction layer.
11.1 Steam
Reads Steam achievements
Reads Steam Workshop mods
Uses Steam cloud if user enables it
Never requires Steam for startup
11.2 GOG
Reads Galaxy API if present
Achievements via GOG
Cloud optional
11.3 Self-Hosted Portal
REST API adapter
Disabled offline
All external integrations follow soft degradation (5.8f).

12. PORTABLE MODE
If launcher detects:
./portable-mode.flag
it forces:
All configs into local directory
All saves into local directory
No registry writes
No $HOME or roaming appdata usage
No cloud features
Ideal for USB/CD/DVD distributions

13. LOGGING & DIAGNOSTICS
Launcher logs:
identity resolution
platform scanning
mod mounting
capability detection
external service state
Debug tools:
Log viewer
Mod manifest inspector
Renderer capability report
Hardware summary
Network test

14. SUMMARY
Volume 6.1 defines:
Universal launcher design
2D vector UI compatible with all platforms
Identity initialization
Mod/DLC mounting
Platform/GPU scanning
Renderer selection
Offline/online handling
Binary dispatch
Crash recovery
Portable mode
Foundation for 6.2‚Äì6.9 volumes
END OF VOLUME 6.1

---

If you are ready, I will now generate:

# **VOLUME 6.2 ‚Äî BUILD TARGETS & EXECUTABLES**

Confirm: **Proceed with Volume 6.2?**
You said:
Yes
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
Understood. I will proceed with VOLUME 6.2 in the same formal specification style as 6.1, building directly on all prior architectural rules.

VOLUME 6.2 ‚Äî BUILD TARGETS & EXECUTABLES
Dominium Engine Specification ‚Äî Distribution & Execution Layer, Part 2
Formal definition of every build target, executable category, platform class, fallback mechanism, and binary deployment expectation for Dominium 1.x.
Everything below is written for deterministic, cross-platform, multi-renderer support on the full range: Win2000‚ÜíWin11, macOS 10.6+, Linux, and future legacy/console/mobile targets.

# VOLUME 6.2 ‚Äî BUILD TARGETS & EXECUTABLES  
Dominium Engine Specification ‚Äî Distribution & Execution Layer, Part 2

---

# 0. PURPOSE

Define the full set of binaries produced by the build system:

- Engine clients (multiple renderers and backends)
- Dedicated servers
- Headless clients
- Editors and devkits
- Tools and auxiliary executables
- Platform-specific wrappers
- Legacy shims

Provide deterministic CI rules, naming conventions, and deployment directories.

---

# 1. NAMING CONVENTIONS

All binaries follow:

    dominium-<role>-<backend>-<platform>.<ext>

Examples:

    dominium-engine-dx11-win64.exe
    dominium-engine-gl2-linux64
    dominium-engine-sdl1-win32.exe
    dominium-launcher-win32.exe
    dominium-server-headless-linux64
    dominium-editor-win64.exe

Dash-separated, no spaces, no camelCase.

For each binary, platform suffixes:

- win32   = Windows 2000‚ÄìXP‚ÄìVista‚Äì7‚Äì8‚Äì10‚Äì11 32-bit  
- win64   = Windows 7‚Äì11 64-bit  
- macos   = macOS 10.6+ universal (fat binaries optional)  
- linux32 = Older Linux glibc 2.3+  
- linux64 = Modern Linux glibc 2.17+  

Legacy ports use additional tags:

- win9x
- dos
- osx-ppc
- linux-legacy

---

# 2. ENGINE EXECUTABLE CATEGORIES

There are **four primary engine execution modes**:

1. **Client**  
2. **Server (Dedicated)**  
3. **Headless Client**  
4. **Editor/Toolchain**

All engine binaries share common determinism rules:
- The simulation core is identical across all platforms.
- Every backend is a thin wrapper around the core.

---

# 3. CLIENT BINARIES

Client binaries render graphics, produce sound, and accept input.

### 3.1 Supported Rendering Backends

These correspond exactly to Stage 1 and Stage 2 renderer plan:

- dx9
- dx11
- gl1
- gl2
- sdl1-software
- sdl2-software

Optional future:
- dx12
- metal
- vk1
- vk2

Each backend builds a separate binary.

### 3.2 Supported Modes

Every client binary is capable of:

- Fullscreen  
- Windowed  
- Borderless  
- Low-spec 2D vector mode  
- No-sound mode  
- Offline mode  
- Replay mode  

### 3.3 Executable Names

Examples:

dominium-engine-dx11-win64.exe
dominium-engine-gl2-macos
dominium-engine-gl1-linux32
dominium-engine-sdl1-software-win32.exe

---

# 4. SERVER BINARIES

Server runs the simulation with:

- No graphics
- No sound
- No input except console commands
- Full determinism

### 4.1 Types

**Dedicated Server**  
`dominium-server-<platform>`

**Managed Server (launcher-spawned)**  
Uses same binary but auto-configured by launcher.

### 4.2 Server Responsibilities

- Simulation ticking  
- Persistence  
- Universe authority  
- Networking (player and AI properties)  
- Replay generation (if enabled)  
- Identity gating (if configured)  

### 4.3 Supported Platforms

- win32  
- win64  
- macos  
- linux32  
- linux64  

Legacy ports will use simplified servers (no threads, no networking extensions).

---

# 5. HEADLESS CLIENT BINARIES

A headless client is a **non-authoritative, no-graphics, no-sound** instance used for:

- Recording replays from a server  
- Running AI analysis  
- Offloading heavy simulation queries  
- Automated testing  
- Streaming data to external tools  
- Compute-heavy routefinding or logistics algorithms  

File names:

dominium-headless-<platform>
dominium-headless-worker-<platform>

Supports:

- Time warp
- Replay playback
- Deterministic branching from snapshots

---

# 6. EDITOR BINARIES

### 6.1 World Editor

dominium-editor-<platform>

Responsibilities:

- Universe editing  
- Region editing  
- Property editing  
- Terrain tools  
- Infrastructure graph editing  
- Biome + climate map editing  
- Entity/property metadata  
- Mod integration  
- Savegame repair  

Supports 2D vector mode and optional GL2.

### 6.2 Devkit Tools

dominium-devkit-<platform>

Tools for:

- dpak creation  
- dpak extraction  
- Asset inspection  
- Data visualization  
- Mod schema validation  
- Auditing determinism rules  
- Stress testing simulation  

### 6.3 Script Tools

dominium-script-compiler
dominium-lua-vm

Used for mod and tool scripting in restricted Lua environment.

---

# 7. MINIMAL BINARY SET PER PLATFORM

### 7.1 Windows 2000‚ÄìXP (win32)

Required:

dominium-launcher-win32.exe
dominium-engine-dx9-win32.exe
dominium-engine-gl1-win32.exe
dominium-engine-sdl1-software-win32.exe
dominium-server-win32.exe
dominium-headless-win32.exe

Optional:

dominium-editor-win32.exe
dominium-devkit-win32.exe

### 7.2 Windows 7‚Äì11 (win64)

Required:

dominium-launcher-win64.exe
dominium-engine-dx11-win64.exe
dominium-engine-dx9-win64.exe
dominium-engine-gl2-win64.exe
dominium-server-win64.exe
dominium-headless-win64.exe

Optional backends:

dominium-engine-dx12-win64.exe
dominium-engine-vk1-win64.exe

### 7.3 macOS 10.6+

dominium-launcher-macos
dominium-engine-gl2-macos
dominium-editor-macos
dominium-server-macos

### 7.4 Linux 32/64

dominium-launcher-linux64
dominium-engine-gl2-linux64
dominium-engine-sdl2-software-linux64
dominium-server-linux64
dominium-headless-linux64

---

# 8. LEGACY PLATFORM TARGETS

Future support under legacy tree:

legacy/win9x/dominium-engine-sdl1.exe
legacy/dos/dominium-dos-stub.exe
legacy/os9/dominium-classic
legacy/osx-ppc/dominium-engine-gl1
legacy/android/dominium-engine-gles2.apk
legacy/ios/dominium-engine-metal.app
legacy/web/dominium-engine-wasm.wasm

Legacy rules:

- No identity tiers beyond Tier 0  
- No mod portal integration  
- Deterministic simulation still required  
- Software or GL1 only  

---

# 9. CONSOLE PLATFORM TARGETS

Kept under `consoles/`:

consoles/switch/
consoles/playstation/
consoles/xbox/

These use **thin launcher stubs** enforced by platform rules.

Console-specific restrictions:

- Determinism critical  
- Mods allowed only if external storage permitted  
- No scripting outside approved sandbox  
- Renderer is platform-native (NVN, GNM, D3D12, GLES)  
- Achievement APIs map to platform trophies  

---

# 10. BINARY GENERATION (BUILD SYSTEM)

Build system must:

1. **Compile deterministic cores first**  
2. **Compile backends second**  
3. **Link minimal dependencies**  
4. **Avoid dynamic loading of renderer plugins** (no DLL plugin system)  
5. **Produce reproducible builds** via fixed timestamps & fixed seeds  
6. **Package dpaks and binaries separately**

Outputs placed in:

/build/<platform>/<variant>/

Variants:

- debug
- release
- lto
- profile
- deterministic-test
- ancient-compat (win2000, xp)
- portable

---

# 11. EXECUTABLE DIRECTORY STRUCTURE

Runtime package layout:

/bin/
dominium-launcher-*
dominium-engine-<backend>-*
dominium-server-*
dominium-headless-*
dominium-editor-*
dominium-devkit-*
/data/
base.dpak
interstellar.dpak
extras.dpak
/mods/
/saves/
/replays/
/logs/
/config/
/portable.flag (optional)

Launcher always uses the `./bin/` directory and never assumes system paths.

---

# 12. EXECUTABLE DISCOVERY RULES

Launcher automatically:

- Detects which binaries are valid on current OS
- Chooses most capable renderer
- Falls back to SDL1-software on failure
- Stores failure history to avoid repeated crashes
- Allows user overrides with explicit selection

---

# 13. RUN MODES PER EXECUTABLE

### 13.1 Client

--config
--windowed
--fullscreen
--nosound
--novector
--renderer=<backend>
--universe=<name>

### 13.2 Server

--config
--port=<n>
--console
--headless
--public / --private

### 13.3 Editor

--load=<save>
--inspect=<dpak>
--vector-only

### 13.4 Headless Client

--record=<file>
--playback=<file>
--branch=<timestamp>

---

# 14. END OF VOLUME 6.2

If ready, I will continue with:
VOLUME 6.3 ‚Äî FILE FORMATS & DATA PACKAGING (dpak, saves, replays)
You said:
Yes
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
Ready to generate VOLUME 6.3, but before I emit it, I must lock one design axis that 6.3 depends on:
QUESTION ‚Äî dpak FORMAT STRATEGY
Dominium supports:
Base game data
DLC (Interstellar, Extras)
Mods (official and third-party)
Resource packs (textures, sounds, music)
Maps, universes, templates
Local overrides
Devkit outputs
Legacy compatibility packs
All must be stored in a deterministic, stable, cross-platform container.
I need you to choose ONE dpak architecture.

OPTION A ‚Äî Single-File Archival dpak (Factorio-style)
A dpak is one file (zip-like, but deterministic).
Pros:
Very simple
Easy to distribute
Good for modders
Stable hashing
Perfect for Steam Workshop sync
Works well on legacy platforms
Cons:
Large mods become slower to update
Incremental patching more difficult
Must extract subsets for some use cases

OPTION B ‚Äî Directory-Based dpak (OpenTTD-style)
A dpak is a directory with manifest + files.
Pros:
Easy partial updates
Easy to browse
Modders can edit files directly
Diff-friendly
Good for development
Cons:
Harder for Steam/GOG syncing
Harder to package for physical media
More vulnerable to accidental edits
Worse deterministic hashing

OPTION C ‚Äî Hybrid dpak (preferred for huge games)
Each dpak can be:
A single archive file, OR
A directory dpak, depending on modder/user choice.
All dpaks appear identical to the engine via a virtual fs layer.
Pros:
Best of both worlds
Great for modding AND distribution
Perfect for DLC
Supports incremental updates (dirs) and stable hashing (archives)
Ideal for your goals:
physical CDs
digital bundles
legacy platforms
mods with many assets
large planetary DLC
devkit workflows
Cons:
Slightly more complexity in implementation
Needs a unified VFS layer

My Recommendation
Given Dominium‚Äôs modular architecture, modding goals, physical/digital distribution, and DLC plans:
üëâ Option C (Hybrid dpak) is the only choice that scales into Volumes 7‚Äì10.
But I will implement whichever design you choose.

Choose dpak format: A, B, or C.
You said:
C
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
# VOLUME 6.3 ‚Äî FILE FORMATS & DATA PACKAGING  
Dominium Engine Specification ‚Äî Distribution & Execution Layer, Part 3  
dpak (Hybrid), Saves, Replays, and Resource Packs

Scope:

- dpak hybrid container format (archive and directory variants)
- Base game, DLC, mods, resource packs, tools using dpak
- Savegame and universe file formats (on-disk structure)
- Replay file packaging (wrapping 5.8d formats into dpak where needed)
- Deterministic hashing rules and integrity
- Versioning, dependencies, compatibility

This volume only defines **on-disk representation** and packaging. Behaviour is covered in earlier volumes.

---

# 0. HIGH-LEVEL PRINCIPLES

1. **Hybrid dpak (Model C)**:
   - dpak can be a **single-file archive** OR a **directory**.
   - Engine sees both through a single virtual filesystem (VFS).

2. **Deterministic & cross-platform**:
   - All metadata canonicalized for hashing.
   - No platform-dependent line endings inside dpaks.
   - All timestamps normalized or excluded from hashes.

3. **Stable identifiers**:
   - Every dpak has a **package ID**, **version**, and **intent**.

4. **Non-executable by default**:
   - dpaks are data containers, not code loaders.
   - Scripting lives inside dpak but runs in sandboxed VM.

5. **Modular layering**:
   - Base game, DLC, mods, resource packs, replays can all be dpaks.
   - Universe saves are separate but may reference or include dpaks.

---

# 1. DPAK TYPES

Each dpak has a **type** recorded in its manifest:

- `core`        ‚Äî base game data (e.g. `base`, `interstellar`, `extras`)
- `mod`         ‚Äî gameplay or content mods
- `resource`    ‚Äî graphics, sounds, music, UI themes, fonts, etc.
- `replay`      ‚Äî packaged replay (and possibly snapshots)
- `template`    ‚Äî universe templates, scenarios
- `tool`        ‚Äî devkit tools / assets
- `legacy`      ‚Äî compatibility packs for older systems

The engine can treat some types specially (e.g. `core` must load first, `resource` only modifies visuals).

---

# 2. DPAK PHYSICAL REPRESENTATIONS

## 2.1 Archive dpak

Single file:

<id>-<version>.dpak

Internally:

- Deterministic archive format:
  - Either zip-with-restrictions or custom (implementation detail)
  - Sorted entries by path, deterministic compression
  - Timestamps normalized to zero or a fixed epoch for hashing

Recommended structure (virtual paths inside archive):

/manifest/package.toml
/data/...
/scripts/...
/locale/...
/docs/...
/media/textures/...
/media/sounds/...
/media/music/...

## 2.2 Directory dpak

Directory with exactly this layout:

<id>-<version>.dpakdir/
manifest/package.toml
data/...
scripts/...
locale/...
docs/...
media/textures/...
media/sounds/...
media/music/...

The engine treats `*.dpak` and `*.dpakdir` equivalently.

Directory dpaks are ideal for development and modding; archive dpaks ideal for distribution, Workshop, physical media.

---

# 3. DPAK MANIFEST: package.toml

Every dpak includes a manifest:

**Path:** `manifest/package.toml`

### 3.1 Minimal fields

```toml
id          = "dominium.base"         # globally unique ID
version     = "1.0.0"                 # semver
type        = "core"                  # core | mod | resource | replay | template | tool | legacy
title       = "Dominium Base Content"
description = "Base game entities, tech tree, assets."
authors     = ["Studio Name", "Contributor Name"]
license     = "All Rights Reserved"
3.2 Engine compatibility
[engine]
min_version = "1.0.0"
max_version = "1.9.99"
3.3 Dependencies
[dependencies]
required = [
  "dominium.base >= 1.0.0",
]
optional = [
  "dominium.interstellar >= 1.0.0"
]
conflicts = [
  "some.other.mod < 2.0.0"
]
3.4 Flags
[flags]
is_dlc         = false
is_official    = true
is_experimental = false
ui_only        = false      # if true, cannot alter simulation core
no_multiplayer = false      # if true, treat as incompatible with MP
3.5 Content indexes (optional but recommended)
[index]
entities    = "data/entities.json"
recipes     = "data/recipes.json"
biomes      = "data/biomes.json"
tech_tree   = "data/tech_tree.json"
resources   = "data/resources.json"
This allows fast scanning without decoding entire data sets.

4. DPAK CONTENT STRUCTURE
Recommended layout (not strictly enforced, but used for tools and devkit):
/manifest/
/data/
/scripts/
/locale/
/media/textures/
/media/sounds/
/media/music/
/media/fonts/
/docs/
4.1 /data/
JSON/TOML/CSV data files describing:
entities, recipes, networks, tech tree
infrastructure types, worker types, transport, etc.
All numeric values stored in canonical units as defined in earlier volumes.
4.2 /scripts/
Lua scripts for:
UI helpers
non-critical automation
scenario scripting
No direct access to filesystem or network.
4.3 /locale/
Language files (e.g. .po, .json, .toml) for localization.
4.4 /media/
textures (PNG, minimal JPG, ideally no WebP for old OS)
sounds (WAV/OGG/FLAC, but WAV for older OS)
music
fonts (TTF/OTF)
4.5 /docs/
Human-readable docs, changelog, credits.

5. DPAK HASHING & INTEGRITY
Each dpak gets:
SHA256 hash of canonical content:
Includes all files except optional docs/, optional generated caches
Ignores timestamps, file system metadata, archive container overhead
The engine computes:
{
  "id": "dominium.base",
  "version": "1.0.0",
  "sha256": "...."
}
Used for:
Multiplayer mod synchronization
Replay compatibility
Deterministic testing
Integrity checks for physical media
Directory dpaks can be re-archived into archive dpaks without changing canonical hash, provided canonicalization rules are followed.

6. BASE GAME & DLC AS DPAKS
6.1 Base Game
dominium.base 1.0.0:
Always present.
Marked type = "core", is_official = true.
No dependencies.
6.2 Interstellar DLC
dominium.interstellar 1.0.0:
type     = "core"
is_dlc   = true
required_by_default = false
[dependencies]
required = ["dominium.base >= 1.0.0"]
6.3 Extras DLC
dominium.extras 1.0.0:
type = "tool" or type = "mod" depending on content
Ships devkit, editors, reference material in a dpak
Tools may live outside dpak but dpak holds associated data

7. MODS & RESOURCE PACKS
7.1 Mods
type = "mod"
Must declare dependencies and conflicts.
Must not mark is_official = true.
May be archive or directory dpak.
Mod discovery paths:
User-local mod directory
Steam Workshop mod directory
Self-hosted portal mod cache
LAN/share mod path
7.2 Resource Packs
type = "resource"
Should have flags.ui_only = true where possible (purely visual/audio).
Can be stacked:
base textures
HD textures
stylized pack
May override:
/media/*
/locale/*
limited /data/ui_themes entries
Resource packs must not alter simulation-critical data.

8. SAVEGAME & UNIVERSE FORMAT
Universe and save files are not dpaks, but dpak-like.
8.1 Universe Directory Structure
Each universe lives in:
saves/<universe_name>/
    meta.json
    state/
        snapshot_00000000.bin
        snapshot_00060000.bin
        ...
    replays/
        session_YYYYMMDD-HHMMSS.domreplay
        ...
    logs/
        ...
    mods.lock
8.2 meta.json
Example:
{
  "universe_id": "uuid-v4",
  "name": "Greenfield",
  "created": "2025-11-30T10:00:00Z",
  "last_played": "2025-12-01T02:15:00Z",
  "engine_version": "1.0.0",
  "tick": 360000,
  "seed": 123456789,
  "canonical_ups": 60,
  "packages": [
    {"id": "dominium.base", "version": "1.0.0", "sha256": "..."},
    {"id": "dominium.interstellar", "version": "1.0.0", "sha256": "..."},
    {"id": "mod.author.example", "version": "1.2.3", "sha256": "..."}
  ]
}
8.3 mods.lock
Contains exactly which dpaks (and checksum) the universe expects; used to:
Validate at load time.
Avoid accidental upgrades that break determinism.
Drive ‚Äúmissing mod‚Äù resolution.

9. SNAPSHOT & SAVE BINARY FORMAT (STATE/*)
Each snapshot_*.bin is a compressed, versioned state file.
Minimal header:
struct SnapshotHeader {
    uint32 magic;         // "DOMS"
    uint16 version;       // snapshot format version
    uint16 flags;
    uint64 tick;
    uint64 universe_seed;
};
Following sections:
Universe metadata (chunk indices, worker pools, etc.)
Chunk data (position, terrain, infrastructure, inventories)
Network graphs (power, fluids, data, transport)
AI state (workers, robots, tasks)
Climate state (for this planet)
RNG state(s)
Compression: zstd or similar.
Snapshots must be:
Complete enough to resume deterministic simulation given same dpaks + seed.
Compatible with replay system‚Äôs ‚Äúbranch from snapshot‚Äù semantics.

10. REPLAY PACKAGING & DPAK INTEGRATION
Volume 5.8d defined:
.domreplay (input-log)
.domsnap (snapshot-only)
.domrplx (hybrid container)
Volume 6.3 defines how these interact with dpak and the filesystem.
10.1 Standalone Replay Files
Live inside:
saves/<universe>/replays/*.domreplay
saves/<universe>/replays/*.domrplx
saves/<universe>/replays/*.domsnap
Each has its own internal metadata referencing:
universe_id
dpak package list (ID, version, sha256)
engine_version
10.2 Replay as dpak (type = "replay")
For sharing, replays may be distributed as dpak:
replays/
  replay.author.greenfield-lan-01.dpak
Structure:
/manifest/package.toml
/replay/segment1.domreplay
/replay/segment2.domreplay
/snapshots/snap_00000000.domsnap
/docs/notes.txt
Manifest:
id      = "replay.author.greenfield.lan01"
version = "1.0.0"
type    = "replay"
title   = "Greenfield LAN Session 01"
[dependencies]
required = [
  "dominium.base >= 1.0.0",
  "dominium.interstellar >= 1.0.0",
  "mod.author.example = 1.2.3"
]
This allows:
Workshop publishing of replays
Portal publishing
LAN distribution

11. DPAK DISCOVERY & LOAD ORDER
The launcher and engine search dpaks in this order:
Core directory:
data/base.dpak
data/interstellar.dpak
data/extras.dpak
User mods directory:
mods/local/*.dpak
mods/local/*.dpakdir
Workshop cache:
mods/steam/<id>/*.dpak*
Portal cache:
mods/portal/*.dpak*
LAN folder:
mods/lan/*.dpak* (if configured)
Load order:
All core dpaks first (sorted by ID)
All legacy dpaks
All mod dpaks ordered by manifest dependencies
All resource dpaks layered last
Conflicts resolved by dependency graph + user preferences.

12. VERSIONING & COMPATIBILITY
12.1 dpak versioning
Semantic versioning: MAJOR.MINOR.PATCH
Engine may reject dpaks:
engine.min_version > engine_current_version
engine.max_version < engine_current_version
12.2 Save compatibility
Universe metadata stores:
engine_version
say save_format_version
packages list with version + sha256
On load:
If engine newer:
attempt safe upgrade, or
require compatibility mode
If engine older:
disallow by default

13. TOOLS & DEVKIT SUPPORT
13.1 dpak creation
Devkit provides:
dom_dpak_build --src=<dir> --out=<file>.dpak
Canonicalizes paths
Normalizes timestamps
Computes sha256
Writes manifest if missing
13.2 dpak inspection
dom_dpak_inspect <file>.dpak
Shows:
metadata
dependencies
file listing
canonical hash
13.3 Directory dpak conversion
dom_dpak_pack <dir>.dpakdir -> <id>-<version>.dpak
dom_dpak_unpack <file>.dpak -> <id>-<version>.dpakdir
Ensures canonical equivalence for hashing.

14. SECURITY & SANDBOXING
dpaks must not:
include native binaries that execute automatically
override core executable files
write outside sandboxed directories
alter identity tiers
inject into network stack
Lua scripts inside dpaks:
run in deterministic VM
no filesystem, network, or OS access
can only use engine-provided APIs (volume 8.x)

15. SUMMARY
Volume 6.3 defines:
Hybrid dpak format: archive (.dpak) and directory (.dpakdir) views
Manifest structure (package.toml) with ID, version, type, dependencies
Canonical hashing rules for deterministic packages
Base game and DLC as core dpaks (dominium.base, dominium.interstellar, dominium.extras)
Mods and resource packs as dpaks layered above cores
Universe save layout (meta + state + replays + lockfile)
Snapshot binary format for deterministic saves
Replay packaging, including dpak-based replay distribution
dpak discovery and load order
Versioning and compatibility strategy
Devkit tools for creating, packing, unpacking, and inspecting dpaks
Security constraints and sandbox boundaries
This volume completes the data packaging layer necessary for launcher (6.1), executables (6.2), and later modding/UI/toolchain volumes.
END OF VOLUME 6.3

::contentReference[oaicite:0]{index=0}
You said:
Proceed
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
Before I generate VOLUME 6.4 ‚Äî PLATFORM DETECTION & CAPABILITY MATRIX, I need one clarifying constraint.
This volume defines exactly how the launcher identifies OS, CPU, GPU, RAM, API support, renderer support, legacy mode, low-spec fallback, and safe-mode rules.
There is only one design choice that must be locked before generation, because it heavily affects the structure of the detection tables and the fallback tree.

CHOOSE ONE DETECTION PHILOSOPHY
(Determines how deep the launcher goes into system probing.)
A ‚Äî Shallow Detection (Minimal Probing)
Detect OS, CPU architecture, GPU vendor, VRAM, available APIs (DX9/11/GL).
No direct hardware queries beyond standard API calls.
Very safe for old OS (Win2000‚ÄìXP).
Avoids risky system calls, avoids driver bugs.
Launcher relies on graceful fallback if detection is ambiguous.
Pros: extremely stable, works on ancient systems.
Cons: less optimized defaults, more user configuration.

B ‚Äî Deep Detection (Aggressive Hardware/Driver Profiling)
Detects everything in A plus:
Exact CPU model
Exact GPU model and driver version
Attempted GL extension enumeration
DirectX capability queries
VRAM, RAM, thread count
Monitor refresh, display modes
Supplies accurate defaults and validates renderers aggressively.
Pros: best automatic configuration, best diagnostics.
Cons: more complex fallback rules, may trigger bugs on very old hardware, slightly higher crash risk on Win9x/Win2000-class systems.

C ‚Äî Dual-Tier Detection (Recommended)
Launcher performs:
Tier 1 (Shallow):
On first launch, or when user requests ‚ÄúSafe Mode‚Äù.
Detects OS, CPU arch, available APIs, minimal GPU data.
Never performs risky calls.
Tier 2 (Deep):
Additional capability probing only if:
User opts in
System is newer than WinXP
Previous runs succeeded without GPU/driver errors
Launcher is running in diagnostic mode
This gives safest behaviour on old systems and the best defaults on new ones.
Cons: requires a two-phase detection design.

My assessment
Your game must run from Win2000 to Win11, macOS 10.6+, Linux, eventually Win9x, DOS, consoles, plus emulate multiple renderers (DX9, DX11, GL1, GL2, SDL1 software).
The detection layer must be stable under extremely old drivers.
The correct design for Dominium is C, unless you explicitly require otherwise.

Choose: A, B, or C.
You said:
C
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
# VOLUME 6.4 ‚Äî PLATFORM DETECTION & CAPABILITY MATRIX  
Dominium Engine Specification ‚Äî Distribution & Execution Layer, Part 4  
Dual-Tier Detection (Tier-1 Shallow, Tier-2 Deep)

Scope:

- How the launcher identifies OS, CPU, GPU, APIs, memory, and display capabilities.
- Definition of **Tier-1 (Safe) detection** vs **Tier-2 (Deep) detection**.
- Capability matrix mapping ‚Üí renderer selection and fallback.
- Legacy mode, low-spec mode, and safe-mode implications.
- Deterministic interaction: detection affects only *defaults*, not simulation logic.

---

# 0. PRINCIPLES

1. **Detection must never break the game**  
   - On failure, assume minimal capabilities and use software/GL1 backends.

2. **Two-tier detection**  
   - **Tier-1 Shallow:** Always safe, used on first run, old OS, and safe mode.  
   - **Tier-2 Deep:** Optional, more detailed, only used on known-safe modern OS or diagnostic mode.

3. **Detection results are advisory**  
   - They produce **recommended defaults** and capability flags for launcher UI.  
   - They never change the simulation core behaviour or determinism.

4. **Legacy-first compatibility**  
   - Windows 2000/XP and planned Win9x/MS-DOS ports cannot tolerate aggressive probing.  
   - Tier-1 must be sufficient to launch the game in low-spec mode.

---

# 1. DETECTION FLOW OVERVIEW

Launcher startup:

```pseudo
startup():
    read_config()
    if safe_mode or first_run or legacy_os:
        mode = "tier1_only"
    else:
        mode = "tier1_then_optional_tier2"

    caps = run_tier1_detection()

    if mode == "tier1_then_optional_tier2" and user_allows_deep_scan and ok_for_os(caps.os):
        caps = merge(caps, run_tier2_detection(caps))

    cache_caps(caps)
    choose_defaults(caps)
    continue_startup(caps)

2. DETECTION RESULT STRUCTURE
The final capability structure is a pure data object:
{
  "os": {
    "family": "windows" | "linux" | "macos" | "other",
    "version": "5.0.2195",               // raw version string
    "class": "win2000" | "winxp" | "win7" | "win10" | "win11" | "mac_10_6" | "mac_modern" | "linux_legacy" | "linux_modern" | "unknown"
  },
  "cpu": {
    "arch": "x86" | "x86_64" | "arm" | "arm64" | "other",
    "logical_cores": 4,
    "physical_cores": 2,
    "flags": ["sse2","sse3"]              // tier2
  },
  "ram": {
    "total_mb": 4096,
    "usable_mb": 3800
  },
  "gpu": {
    "present": true,
    "vendor": "nvidia" | "amd" | "intel" | "unknown",
    "name": "GeForce GTX 960",           // tier2
    "vram_mb": 2048,
    "driver_version": "xxx.yyy.zzz",     // tier2
    "supports_dx9": true,
    "supports_dx11": true,
    "supports_gl1": true,
    "supports_gl2": true
  },
  "apis": {
    "dx9":  { "available": true,  "tier": "native" },
    "dx11": { "available": true,  "tier": "native" },
    "dx12": { "available": false, "tier": "none" },
    "gl1":  { "available": true,  "tier": "native" },
    "gl2":  { "available": true,  "tier": "native" },
    "sdl1": { "available": true,  "tier": "fallback" },
    "sdl2": { "available": true,  "tier": "native" }
  },
  "display": {
    "primary_width": 1920,
    "primary_height": 1080,
    "refresh_hz": 60,                    // tier2
    "multi_monitor": false,              // tier2
    "max_fullscreen_modes": 10           // tier2
  },
  "flags": {
    "legacy_os": false,
    "low_ram": false,
    "low_vram": false,
    "headless_possible": true,
    "safe_renderer_required": false
  }
}
Tier-1 sets a subset; Tier-2 fills in and refines.

3. TIER-1 (SHALLOW) DETECTION
Tier-1 must:
Use only minimal, stable APIs.
Avoid advanced driver/probing calls.
Work safely on Win2000/XP/9x, old macOS, old Linux.
3.1 OS Class
Identify:
OS family via standard APIs (GetVersionEx, uname, etc.).
Map into class:
win2000 / winxp / win7 / win8 / win10 / win11
mac_10_6 / mac_legacy / mac_modern
linux_legacy / linux_modern
unknown
Set flags.legacy_os = true if:
Windows version ‚â§ XP/Vista
macOS 10.6‚Äì10.8
Linux with old glibc (approx detection via dynamic loader or minimal runtime test)
3.2 CPU Arch & Core Count
From standard OS calls, no CPUID or privileged instructions:
cpu.arch = x86 / x86_64 / arm / arm64 / other.
logical_cores: number of detected threads.
No deep instruction set probing at Tier-1.
3.3 RAM & VRAM (Coarse)
ram.total_mb via standard OS query; if not available, approximate or mark unknown.
gpu.present = true if any expected GPU/driver present.
gpu.vram_mb coarse; if not available, approximate thresholds or mark unknown.
3.4 API Availability (Coarse)
Perform only existence checks, not capability enumeration:
For DirectX: check if d3d9.dll / d3d11.dll loadable.
For OpenGL: check if a basic context can be created.
For SDL1/SDL2: check that the corresponding libs are present or statically linked.
Mark:
"apis.dx9.available": true/false
"apis.dx11.available": true/false
"apis.gl1.available": true/false
"apis.gl2.available": true/false
"sdl1/sdl2.available": true/false
No extension enumeration at Tier-1.
3.5 Flags (Low-spec & Legacy)
Set:
flags.low_ram = (total_mb < 2048)
flags.low_vram = (vram_mb < 512 or unknown)
flags.safe_renderer_required = legacy_os OR low_vram OR gpu.present == false

4. TIER-2 (DEEP) DETECTION
Tier-2 is optional, and may be triggered only when:
OS is win7 or later, mac_modern, or linux_modern.
User allows ‚Äúdetailed hardware detection‚Äù.
There is no history of GPU/driver-related crashes for this system.
Not in explicit/hardcore offline modes.
4.1 CPU Capabilities
Safe use of CPUID and OS-provided information:
logical_cores refined
physical_cores estimated
cpu.flags (e.g., sse2/sse3/avx/avx2)
Used only for performance hints, not for gating simulation.
4.2 GPU & Driver Info
Using appropriate APIs:
GPU vendor and name
Driver version string
More precise VRAM
Driver feature level (for DX11)
If any deep GPU probe fails, Tier-2 aborts and preserves Tier-1 results.
4.3 OpenGL Extension Enumeration (Guarded)
If GL2 available and OS is modern:
Query supported GL version
Query key capabilities relevant to Dominium:
FBO support
NPOT textures
basic shader support
If extension enumeration fails, mark GL2 as ‚Äúdegraded‚Äù and fallback to GL1 or software backend.
4.4 Display Modes
Non-essential, used only for default resolution choice:
Enumerate supported fullscreen resolutions
Determine highest ‚Äúsane‚Äù mode within VRAM and refresh constraints
Multi-monitor presence
Failure here must not affect ability to run; default to a safe 1280√ó720 or 1024√ó768.

5. CAPABILITY MATRIX ‚Üí RENDERER CHOICE
Given caps, launcher chooses a recommended renderer, which user may override.
5.1 Renderer Priority by OS Class
Windows 7‚Äì11, modern GPU
Default priority:
DX11
DX9
GL2
GL1
SDL2-software
SDL1-software
Windows 2000‚ÄìXP
DX9
GL1
SDL1-software
DX11 is not considered.
macOS
10.6‚Äì10.13: GL2 ‚Üí GL1 ‚Üí SDL2-software
10.14+: GL2 (later Metal) ‚Üí SDL2-software
Linux
Modern: GL2 ‚Üí GL1 ‚Üí SDL2-software
Legacy: GL1 ‚Üí SDL1-software
5.2 Low-spec Overrides
If:
flags.low_ram OR flags.low_vram OR flags.safe_renderer_required is true:
Then recommended:
2D vector + minimal texture sizes.
SDL2-software or GL1, even if more advanced is available.
Default resolution ‚â§ 1280√ó720.
User can still override to ‚ÄúHigh‚Äù or ‚ÄúUltra‚Äù graphics, but launcher warns.

6. SAFE MODE & FALLBACK RULES
Safe mode can be triggered by:
User selecting ‚ÄúSafe Mode‚Äù in launcher.
Previous crash log indicating renderer failure.
Legacy OS detection.
In Safe Mode:
Tier-2 detection is disabled.
Renderer forcibly set to:
SDL1-software / SDL2-software / GL1-very-safe.
Resolution limited (e.g. 1024√ó768 windowed).
Advanced visual settings disabled by default.
If a renderer fails at engine start:
Launcher records failure in a local cache:
"renderer_fail_history": {
   "dx11": "2025-11-29T10:15:00Z",
   "gl2": "2025-11-30T12:00:00Z"
}
Next run: those backends are deprioritized.
User can manually reset this history.

7. LOW-END PLATFORM HANDLING
For known low-end combos (e.g. Win2000 + Intel iGPU + 512MB RAM):
Default:
SDL1 or GL1 software, 2D vector UI only.
Very conservative UPS/FPS defaults.
Minimal number of background threads.
Disabled fancy post-processing.
Launcher must present this clearly, but allow advanced overrides with warnings.

8. CACHING & REUSE OF CAPS
Detection results stored in:
config/capabilities.json
Contents:
Last detection result
Timestamp
Hash of OS+driver+GPU+CPU snapshot
On startup:
If nothing significant changed, reuse cached caps.
If GPU driver changed (approx detection via version string) ‚Üí rerun Tier-1 and optionally Tier-2.

9. DIAGNOSTICS UI
Launcher must offer:
‚ÄúView system capabilities‚Äù page showing caps.
‚ÄúRun advanced detection (Tier-2)‚Äù button on supported systems.
‚ÄúForce safe mode‚Äù toggle.
‚ÄúReset renderer history‚Äù button.
No detection paths run concurrently with simulation. Everything is strictly pre-launch.

10. INTEGRATION WITH OTHER VOLUMES
6.1 Launcher Core: uses caps to choose default renderer, UPS/FPS, and UI detail level.
6.2 Executables: must be built for all relevant backends; capability matrix maps to available binaries.
6.3 dpak & resources: high-res vs low-res packs can be recommended based on caps.
2.x Determinism: detection never touches sim logic or RNG; it is solely a pre-launch configuration suggestion.

11. SUMMARY
Volume 6.4 defines:
A dual-tier detection pipeline (Tier-1 shallow, Tier-2 deep).
A unified capability structure (caps) for OS, CPU, GPU, RAM, APIs, and display.
OS classification into legacy vs modern categories.
Safe, minimal Tier-1 suitable even for Win2000/XP and future Win9x/DOS ports.
Optional Tier-2 deep probing for modern systems, only when safe and user-approved.
A capability matrix mapping to renderer and graphics defaults, including low-spec and safe mode.
Stable handling of crashes via failure history and conservative fallback.
Strict separation: detection influences only defaults, not simulation determinism or core logic.
END OF VOLUME 6.4

::contentReference[oaicite:0]{index=0}
You said:
Proceed
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
Before I generate VOLUME 6.5 ‚Äî MOD LOADER & DLC LOADER AT LAUNCH, I need one architectural choice locked, because it directly determines how the mod loader resolves dpaks, handles conflicts, merges data, and exposes mod-order to the engine.
There are two valid philosophies for Dominium‚Äôs mod-loading architecture, and this is a hard fork in the design. Everything in 6.5 depends on this choice.

CHOOSE DOMINIUM‚ÄôS MOD LOADING PHILOSOPHY
A ‚Äî Strict Layered Order (Factorio-like, deterministic stack)
Every dpak layer is applied in a strict, deterministic sequence:
Core dpaks (base, interstellar, extras)
Official DLC
Legacy packs
Mods (ordered)
Resource packs (visual only)
Local overrides
Rules:
Exact load-order index is computed by dependency graph + explicit mod ordering.
Later mods override earlier ones.
Data merges follow strict merging semantics:
appending, overwriting, or requiring explicit conflict resolution.
This model ensures absolute determinism across platforms.
Conflicts = errors unless explicitly resolved.
Pros
Perfect determinism
Very reliable in multiplayer
Fully reproducible based on mod list + order
Ideal for technical simulation games
Cons
Requires modders to follow strict rules
Some Mod A + Mod B combinations may be incompatible
Less flexible dynamic patching

B ‚Äî Patch-Oriented Merge System (OpenTTD-like flexible merges)
In this model:
dpaks apply patches to existing data tables.
Mods can selectively override specific keys without replacing entire files.
Load ordering is looser; dependencies still matter but strict layering is reduced.
Launcher must calculate a stable merge graph.
Pros
Very mod-friendly
Mods don‚Äôt need to define entire structures
Resource packs can override anything
Higher compatibility between unrelated mods
Cons
Much more complex
Harder to guarantee cross-platform determinism
Multiplayer must reject combinations with nondeterministic merges
Conflict detection harder

C ‚Äî Hybrid Strict-Core + Flexible-Visual (Recommended)
A split approach:
Simulation-critical data: STRICT
Used for:
entities
infrastructure
tech tree
networks (electrical/fluids/data)
recipes
workers
research
AI
planet definitions
climate parameters
logistics, transport, economics
These must use strict layered order and deterministic merges.
Visual/audio/UI data: FLEXIBLE
Used for:
textures
models
animations
UI themes
sound
music
These may use patch-style overrides and free-form merging.
This hybrid model gives:
Determinism where it matters
Modding flexibility where safe
Safe multiplayer compatibility
High-performance data loading
Allows resource packs to stack arbitrarily
Allows simulation mods to remain fully deterministic
Prevents a UI-only pack from breaking gameplay
This is the best architecture for Dominium.

My Recommendation
Given Dominium‚Äôs scale, determinism requirements, modding goals, DLC layering, dpak hybrid format, and your desire for strong determinism:
üëâ Option C (Hybrid Strict-Core + Flexible-Visual) is clearly superior.
But I will implement whichever you choose.

Select A, B, or C.
You said:
C
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
Understood. Proceeding with VOLUME 6.5 using Hybrid Strict-Core + Flexible-Visual Mod Loading.
# VOLUME 6.5 ‚Äî MOD LOADER & DLC LOADER AT LAUNCH  
Dominium Engine Specification ‚Äî Distribution & Execution Layer, Part 5  
Hybrid Strict-Core + Flexible-Visual Mod Architecture

This volume defines:

- dpak discovery and classification  
- strict-core simulation mod loading (deterministic)  
- flexible visual-layer mod loading (UI, textures, sounds)  
- DLC integration  
- load order computation  
- dependency + conflict resolution  
- safe-mode loading  
- multiplayer mod synchronization  
- how mods interact with core simulation structures  
- launcher UI and error-handling semantics  

---

# 0. OVERVIEW

Dominium loads dpaks in a canonical sequence, split into two major domains:

1. **CORE DOMAIN (strict, deterministic)**  
   - entities  
   - infrastructure  
   - networks (electrical/fluids/data)  
   - recipes, resources  
   - tech tree  
   - workers, robots  
   - world generation  
   - climate parameters  
   - logistics/transport rules  
   - economy, markets  
   - simulation constants  

2. **VISUAL DOMAIN (flexible, non-critical)**  
   - textures  
   - models  
   - sprites  
   - animations  
   - UI themes  
   - fonts  
   - audio  
   - music  
   - icons  
   - shader variants (non-sim-affecting)  

Both domains are loaded from dpak packages but follow different merging rules.

---

# 1. DPAK DISCOVERY SOURCES

Launcher scans in this order:

1. **Core installation dpaks**  
   - `data/base.dpak`  
   - `data/interstellar.dpak`  
   - `data/extras.dpak`

2. **User mod directories**  
   - `mods/local/*.dpak*`  
   - `mods/local/<modname>.dpakdir/`

3. **Workshop directories**  
   - `mods/steam/<workshopid>/`

4. **Portal/self-hosted repositories**  
   - `mods/portal/*.dpak*`

5. **LAN/shared mod paths**  
   - if configured.

All dpaks are given equal treatment after discovery.

Each dpak's manifest determines its:

- **type** (`core`, `mod`, `resource`, `tool`, `template`, `replay`, `legacy`)  
- **domain** (core or visual)  
- **dependencies**, **optional dependencies**, and **conflicts**  
- **version** and **identifier**

---

# 2. SPLITTING DPAKS BY DOMAIN

## 2.1 Core Domain dpaks
Determined by:

- `type = "core"`  
- `type = "mod"` (simulation-affecting)  
- `flags.ui_only = false`

These affect simulation or world generation.

## 2.2 Visual Domain dpaks
Determined by:

- `type = "resource"`  
- `flags.ui_only = true`  
- Asset packs in `/media/*`  

These never affect simulation determinism.

---

# 3. CORE DOMAIN LOADING (STRICT, DETERMINISTIC)

Core dpaks form a dependency graph with:

- **required dependencies**  
- **optional dependencies**  
- **conflicts**  
- **version constraints**  

The loader must compute a deterministic load order:

Base game (always first)
Official DLC (in dependency order)
Legacy support packs
Simulation mods (in dependency-stable order)

## 3.1 Deterministic Merge Semantics

Core data is structured as maps/tables of:

- entity prototypes  
- recipe definitions  
- resource definitions  
- network specifications  
- climate & biome parameters  
- infrastructure definitions  

Merges follow:

### RULE A ‚Äî Keyed Tables  
If two dpaks define `entities/machine.json`:

- They must define unique IDs.  
- If same ID appears twice:
  - second must explicitly state `"override": true`  
  - OR loader raises a conflict.

### RULE B ‚Äî No Silent Overwrites  
Implicit overwrites are disallowed.

### RULE C ‚Äî Explicit Extensions  
A dpak may add new fields:

```json
{
  "extends": "machine.steel",
  "new_field": 123,
  "override_field": { "value": 10, "override": true }
}
RULE D ‚Äî Stable Ordering
Ordering determined by:
Dependency graph topological sort
Manifest load_priority if needed
Alphabetical fallback if fully equal
RULE E ‚Äî Version Locking
dpaks not matching version constraints produce hard errors.
Tier-0 (anonymous) can bypass errors only with launch override flags.

4. VISUAL DOMAIN LOADING (FLEXIBLE)
Resource packs:
Are stacked in priority order (same ordering algorithm as core mods)
But merges are non-destructive: last pack wins for visual keys
No error on conflict ‚Äî just overwrite path
Example:
HD Texture Pack overrides base textures
Retro UI Pack overrides UI theme
Audio pack overrides music or SFX
Visual domain does not affect simulation and is always reversible.

5. DLC LOADING
dominium.interstellar and dominium.extras are type="core" but flagged:
is_dlc = true
DLC is treated identically to core modules:
Loaded immediately after base
Adds new entities, recipes, infrastructure, planets
May include large content expansions
Users may disable DLC when starting a new universe but not within an existing universe (due to simulation consistency).

6. LOAD ORDER COMPUTATION
Steps:
Build graph of all dpaks with edges from dependency rules.
Check for incompatible versions.
Check for cycles.
Check declared conflicts.
Topologically sort the graph.
Split the sorted list into:
core domain stack
visual domain stack
Validate pack domains (ui_only mods must not modify core tables).
Produce final ordered load list.
Result:
{
  "core_load_order": [
    "dominium.base",
    "dominium.interstellar",
    "dominium.legacy.europe",
    "mod.author.powergrid",
    "mod.author.transport2",
    "mod.author.aiworkers"
  ],

  "visual_load_order": [
    "resource.hdtextures",
    "resource.uiremodel",
    "resource.soundpack",
    "resource.music_orchestral"
  ]
}

7. SAFE MODE & BROKEN MOD HANDLING
In Safe Mode:
Disable all mods except core dpaks.
Disable all visual packs.
Disable all optional dependencies.
Use base-only load list.
If dpak corruption detected, quarantine dpak into mods/disabled/.
Launcher UI must show:
Which mods failed
What conflict/constraint failed
Button to launch without mods

8. MULTIPLAYER MOD SYNC
Multiplayer requires:
Exact dpak ID matches
Exact dpak version matches
Exact dpak SHA256 matches
Exact load order matches
Exact core/visual separation matches
Launcher resolves this automatically:
If hosting: server broadcasts mod list to clients.
If client: launcher compares local dpaks to server list.
Missing dpaks are downloaded if:
Available via Workshop
Available via Portal
Available via LAN share
Otherwise: connection rejected (unless in Tier-0/anonymous override mode).
Snapshots and replays embed the mod list, which the launcher uses to validate compatibility.

9. MODDER EXPERIENCE
Modders have:
Directory dpaks for development (something.dpakdir/)
Archive dpaks for distribution (something.dpak)
Devkit to validate:
Manifest correctness
Dependency graph
Deterministic core data formatting
Tools to check whether a dpak is:
Simulation-safe
Visual-only
Mixed (must declare domains in manifest)

10. LAUNCHER UI REQUIREMENTS
Launcher must display:
10.1 Mod List UI
Master toggle: enable/disable all mods
Individual toggles
Domain icons (core, visual, resource, tool)
Version number & compatibility
Dependency graph visualization
Conflict warnings
Load order inspector
Button: ‚ÄúFix Load Order‚Äù (auto topological sort)
10.2 DLC Management
Show Interstellar, Extras
Enable/disable DLC at new-universe creation
Explanations about determinism and save compatibility
10.3 Visual Packs UI
Stacking order
Preview screenshot
Enable/disable
Reset-to-default button

11. ERROR HANDLING
Launcher must detect:
Missing required dpaks
Duplicate dpak IDs
Conflicting version constraints
Cycles in dependency graph
Simulation mod modifying visual domain or vice versa
Unrecognized fields or broken manifests
Error levels:
Hard error: cannot load universe
Soft error: can load but features disabled
Deferred warning: visual-only conflict or metadata mismatch

12. SUMMARY
Volume 6.5 defines:
The hybrid mod system: strict-core + flexible-visual
dpak domain identification
Deterministic merge rules for simulation content
Freeform merge rules for visual/UI/audio content
Full DLC integration as core dpaks
Load order computation via dependency graph
Safe-mode behaviour and broken mod handling
Multiplayer mod syncing via ID, version, SHA256, and order
Launcher UI requirements for mod management
Devkit and inspection tools for modders
With this architecture, Dominium supports:
Fully deterministic simulation across platforms
Powerful and safe modding
Visual/resource packs with total freedom
Seamless DLC integration
Multi-service mod delivery (Workshop, Portal, LAN)
END OF VOLUME 6.5

Ready to continue with **VOLUME 6.6 ‚Äî PORTAL / WORKSHOP INTEGRATION**, unless you want to alter or expand part of 6.5 first.
You said:
Yes
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
Before I generate Volume 6.6, I need to lock in one critical architectural decision that the entire portal/workshop integration depends on.
This volume governs:
Steam Workshop integration
GOG Galaxy mod delivery
Self-hosted Dominium Portal
Offline-first behaviour
LAN mod distribution
Automated sync, updates, signatures
Multi-tier identity (Tier-0, Tier-1, Tier-2)
How dpaks move between all these ecosystems
Determinism across distributed sources
To write this correctly, I need your answer to the following:

CHOOSE DOMINIUM‚ÄôS MOD DISTRIBUTION MODEL
This choice determines how mods, resource packs, replays, templates, and DLC synchronize across Steam, GOG, the Dominium Portal, LAN, and offline environments.
There are three possible models.

A ‚Äî Federation Model (Decentralized, Recommended)
Every mod source is equal:
Steam Workshop
GOG Galaxy
Dominium Portal (self-hosted or official)
LAN shares
Local folders
Manual ZIP/dpak files
The launcher unifies all of them under a single mod registry, resolving:
dpak identity
version
SHA256
distribution origin
trust level
available updates
Mods can originate from any source and the launcher handles:
cross-source matching
update propagation
dependency resolution
Features:
Full offline compatibility
Self-hostable Dominium Portal nodes
Steam/GOG integrations optional
LAN sync available
Mods never locked behind a single service
No DRM beyond dpak SHA256 integrity
Identity tiers do not restrict distribution
This is the most powerful and aligns with your philosophy.

B ‚Äî Hierarchical Model (Like Cities Skylines / Paradox)
Priority order is enforced:
Steam Workshop
Dominium Portal
Local mods
LAN mods
Manual imports
If multiple sources have the same mod:
The highest-priority source overrides the rest.
Updates only come from the topmost source.
Pros:
Simple logic
Mirrors structure of existing commercial games
Cons:
Weak offline support
Harder for modders who distribute both via Steam and Portal
Not compatible with self-hosted ecosystems

C ‚Äî Source-Strict Model (Like Factorio)
A mod is bound to its distribution source:
Steam mods update only through Steam
Portal mods update only through Portal
Manual mods never auto-update
LAN mods are static copies
No source mixing
Pros:
Very predictable
No risk of source conflict
Minimal complexity
Cons:
Weak interoperability
No mixing between ecosystems
No replication across services

MY ANALYSIS
Given that Dominium:
Must support offline-only universes
Must support LAN-only multiplayer
Must support Steam, GOG, and a self-hosted Portal concurrently
Must support dpak hybrid (directory + archive)
Must support anonymous, local, and account-tier identity
Must integrate editor, devkit, extras as dpaks
Must support physical media
Requires strict determinism in mods
The only model that handles all of this without breaking your constraints is:
üëâ A ‚Äî Federation Model
This gives you:
Mod discoverability from all sources
Bidirectional sync when appropriate
Full offline capability
Deterministic dpak-based identity
No DRM
Optional identity tiering
Perfect support for physical copies
Max compatibility with future consoles and offline devices
But I will implement whichever model you select.

Choose A, B, or C.
You said:
A
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
# VOLUME 6.6 ‚Äî PORTAL / WORKSHOP INTEGRATION  
Dominium Engine Specification ‚Äî Distribution & Execution Layer, Part 6  
Federated Mod Distribution Model

Scope:

- Federation model for all content sources:
  - Steam Workshop
  - GOG Galaxy (mods/DLC)
  - Dominium Portal (official/self-hosted)
  - LAN shares
  - Local folders
  - Physical media
- Unified Mod Registry
- Download, update, verify, and cache logic
- Offline-first, DRM-free behaviour
- Interaction with identity tiers (5.8e) and offline modes (5.8f)
- Deterministic dpak identity across all sources

---

# 0. DESIGN PRINCIPLES

1. **Federation, not hierarchy**  
   All sources are peers: Steam, GOG, Portal, LAN, local, physical.

2. **dpak identity is the truth**  
   A mod is identified by:
   - `id` (string, from manifest)
   - `version` (semver)
   - `sha256` (canonical hash from 6.3)

   Source is metadata, not identity.

3. **Offline-first**  
   - All content operates from local cache.
   - Game fully playable with zero online services.
   - No DRM; no mandatory logins.

4. **Determinism preserved**  
   - Simulation uses dpak ID+version+hash only.
   - Source, author, signatures, and download paths do not affect sim.

5. **User-controlled**  
   - User can enable/disable any source.
   - User chooses update policies per source.
   - No forced auto-updates.

---

# 1. CONTENT SOURCES

Supported sources:

- `local`       ‚Äî manually installed dpaks / dpakdirs
- `portal`      ‚Äî Dominium Portal (official or self-hosted)
- `steam`       ‚Äî Steam Workshop
- `gog`         ‚Äî GOG Galaxy
- `lan`         ‚Äî LAN share or local HTTP/SMB share
- `physical`    ‚Äî CD/DVD, USB, read-only media
- `other`       ‚Äî reserved for future (e.g. console marketplaces)

Each source has a **Source Adapter**.

---

# 2. UNIFIED MOD REGISTRY

Launcher maintains a single **Mod Registry**:

```json
{
  "mods": {
    "mod.author.powergrid": {
      "id": "mod.author.powergrid",
      "versions": {
        "1.0.0": {
          "sha256": "abcd...",
          "sources": ["local","steam"],
          "installed_path": "mods/local/mod.author.powergrid-1.0.0.dpak",
          "enabled": true,
          "domain": "core",
          "type": "mod",
          "official": false
        },
        "1.1.0": {
          "sha256": "efgh...",
          "sources": ["portal"],
          "installed_path": null,   // known but not yet downloaded
          "enabled": false
        }
      }
    },
    "resource.hdtextures": {
      "id": "resource.hdtextures",
      "versions": { ... }
    }
  }
}
Storage:
config/mod_registry.json
This registry is the single source of truth for:
which mods exist
which versions are known
which versions are installed
which sources supply each version
which versions are active per-universe (via mods.lock in saves)

3. SOURCE ADAPTERS
Each adapter implements a uniform interface:
list_available()    ‚Üí [RemoteModVersion]
fetch(mod_id, ver)  ‚Üí dpak file
resolve_id(hint)    ‚Üí canonical mod_id
Where RemoteModVersion contains:
{
  "mod_id": "mod.author.powergrid",
  "version": "1.1.0",
  "sha256": "efgh...",
  "title": "Advanced Power Grid",
  "description": "...",
  "author": "AuthorName",
  "tags": ["power","infrastructure"],
  "size_bytes": 12345678
}
Adapters:
3.1 Local Adapter (local)
Scans mods/local/*.dpak* and mods/local/*/*.dpak*.
Never downloads anything.
Marks content as sources = ["local"].
Only adapter guaranteed in all builds.
3.2 Portal Adapter (portal)
Talks to Dominium Portal via REST (if enabled and online).
Supports:
browsing mods, resource packs, replays, templates
downloading dpaks
publishing (optional)
Works with official or self-hosted instances.
Disabled when:
in hardcore offline mode
in explicit offline mode
or no endpoint configured
3.3 Steam Adapter (steam)
Uses Steam Workshop API (if Steam present).
Supports:
listing subscribed items
downloading/updating items into mods/steam/<id>/...
Never required for core functionality.
3.4 GOG Adapter (gog)
Uses GOG Galaxy APIs (if present).
Similar to Steam adapter but specific to GOG.
3.5 LAN Adapter (lan)
Uses local network shares:
HTTP, SMB, NFS, or even shared directories.
Simple index format:
index.json listing available dpaks and metadata.
Ideal for LAN events, classrooms, offline groups.
3.6 Physical Adapter (physical)
Treats CD/DVD/USB as read-only mod source.
Scans for mods/*.dpak* and data/*.dpak*.
Suitable for:
shipping special content on discs
distributing modpacks physically

4. FEDERATION RULES
4.1 Identity Matching
If any two sources report:
same mod_id
same version
same sha256 (or verified equivalence)
Then they are treated as the same mod.
The registry merges them:
"sources": ["local","steam","portal"]
4.2 Divergent Builds (Same ID, Different Hash)
If a mod with same id and version but different sha256 appears from different sources:
Mark as conflict.
Only one may be installed at a time.
Launcher UI must show:
mod_id
version
hashes
available sources
User must choose:
which variant to trust
or to treat them as separate mods via renaming.
Multiplayer and determinism:
Only one hash is valid for a given ID+version per universe.
Universe metadata (mods.lock) pins exact id+version+hash triple.

5. INSTALL / UPDATE WORKFLOW
5.1 Discovery
On demand or on schedule:
Each adapter provides list of available mods/versions.
Registry merges new metadata into mod_registry.json.
No downloads occur at this stage unless user triggers them.
5.2 Install
When user chooses ‚ÄúInstall‚Äù for a version:
Launcher selects preferred source based on:
user‚Äôs per-source settings
availability
trust preferences
Adapter fetch() downloads dpak to local cache:
mods/cache/<mod_id>/<version>/<hash>.dpak
Launcher verifies sha256.
Launcher copies or hard-links dpak into the relevant mod directory:
mods/local/ (root install target, regardless of source)
or retains in mods/steam / mods/portal for source-specific paths if necessary, but the registry always points to the canonical installed_path.
Registry updated: installed_path, enabled = false by default.
5.3 Update
When new version exists:
Registry marks version as ‚Äúavailable‚Äù.
User can:
‚ÄúUpdate this universe to new version‚Äù (may break determinism)
‚ÄúInstall but don‚Äôt activate yet‚Äù
‚ÄúIgnore this update‚Äù
For existing universes:
mods.lock controls whether a universe accepts updated versions:
default: locked to exact versions used at creation.
upgrades require explicit user consent.

6. OFFLINE AND DEGRADED MOD BEHAVIOUR
6.1 Offline Mode
Only local dpaks are considered ‚Äúinstalled‚Äù.
Remote sources disabled.
Registry still stores known remote versions if previously fetched metadata exists.
No downloads, no auto-updates.
6.2 Degraded Service (5.8f)
If a given source fails mid-session:
That adapter transitions to offline.
Installed mods remain usable.
Update checks stop.
No UI errors beyond a single soft status indicator.
6.3 LAN-only Scenarios
User can:
Disable all remote sources.
Enable only local and lan.
All mod distribution occurs over LAN.
Ideal for isolated networks.

7. MULTIPLAYER & FEDERATED MOD RESOLUTION
When joining a server:
Server provides universe‚Äôs mods.lock:
list of id, version, sha256.
Launcher checks registry:
If matching installed version exists ‚Üí OK.
If known but not installed ‚Üí attempt to fetch from any source that has that sha256.
If unknown ‚Üí user must obtain dpak manually or via LAN.
Federation behaviour:
If mod is available from multiple sources, any validated match is acceptable.
Determinism cares only about hash, not source.
If dpak cannot be obtained:
Connection rejected (standard mode).
In debug/testing modes, user may choose to connect with broken mods (non-deterministic, for testing only).

8. DOMINIUM PORTAL (OFFICIAL / SELF-HOSTED)
The Portal is a generic HTTP/REST service that:
Serves mod metadata
Serves dpak files
Optionally authenticates users (for official or curated portals)
May host:
mods
resource packs
replays (as type=replay dpaks)
templates
DLC metadata (if you choose to distribute DLC this way later)
Client config:
[portal]
enabled = true
endpoint = "https://portal.dominium-game.net/"
timeout_sec = 5
allow_unverified = false   # require TLS + cert validation
Self-hosted portals:
Provide same API shape.
Allow communities to host their own mod ecosystems.
Work with or without official Portal.

9. STEAM / GOG INTEGRATION DETAILS
9.1 Steam
Identify Workshop items by published_file_id.
Map Workshop items to mod_id/version via manifest inside dpak.
Steam adapter:
detects subscribed items
pulls dpaks into mods/steam/<id>/
informs Mod Registry.
Workflows:
User can disable Steam source entirely.
Steam-only mods can be repacked for local use via devkit (if license permits).
9.2 GOG
Similar to Steam, but using GOG APIs.
May provide both mods and DLC.
Still integrated into the same Mod Registry.

10. UI DESIGN REQUIREMENTS (LAUNCHER)
10.1 Sources Panel
Shows each source:
local, portal, steam, gog, lan, physical
For each:
Enabled/disabled toggle
Online/offline state
Last sync time
Options (e.g., portal endpoint, LAN path)
10.2 Mod Browser
Unified view:
Filters by:
installed / not installed
source
type (mod, resource, template, replay)
domain (core, visual)
View a mod:
metadata (title, desc, authors, license)
sources and their status
versions and sizes
dependencies/conflicts
install/update/remove actions
10.3 Universe-specific Mod View
For a selected universe:
Show which mod versions are pinned (mods.lock).
Show which are missing or outdated.
Buttons:
‚ÄúSync to installed set‚Äù (replace mod set with currently installed versions ‚Äî may break determinism)
‚ÄúSync installed to universe‚Äù (rollback/downgrade mods to match universe)

11. SECURITY AND TRUST
dpaks may optionally be signed (future volume), but:
signatures are advisory.
simulation relies only on hash.
Source trust levels:
trusted (official portal, signed)
community (self-hosted portal, Steam, GOG)
manual (local/physical)
User can restrict auto-download to trusted sources only.
No DRM:
Mods never bound to a particular account identity.
Offline copy of a dpak is enough for usage.

12. TOOLING
Devkit must support:
Publishing dpaks to:
local folder
Portal (if credentials configured)
Steam Workshop / GOG (where supported)
Exporting dpaks for physical distribution.
Generating metadata for LAN index.
Example CLI:
dom_dpak_publish --to=portal --file=mod.author.powergrid-1.1.0.dpak
dom_dpak_publish --to=lan --file=mod.author.powergrid-1.1.0.dpak --output=/share/mods/

13. SUMMARY
Volume 6.6 defines:
A federated mod distribution model where:
Steam, GOG, Portal, LAN, local, and physical media are all equal sources.
A single Mod Registry keyed by dpak id, version, sha256.
Source adapters for:
local, portal, steam, gog, lan, physical.
Deterministic mod identity independent of distribution origin.
Offline-first, DRM-free behaviour with full local caching.
Multiplayer mod resolution based solely on id+version+hash.
Safe degraded behaviour under partial network/service failure.
Launcher UI for source control, mod browsing, and universe-specific mod lock management.
Devkit hooks for publishing and exporting dpaks to any source.
This volume completes the external distribution side of Dominium‚Äôs mod ecosystem, ready for deeper modding API and scripting design in Volume 8.x.
END OF VOLUME 6.6

::contentReference[oaicite:0]{index=0}
You said:
Proceed
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
You need to specify which volume or subsection to continue.
We have completed Volume 6.6.
The next major chapters available are:
Volume 6.7 ‚Äî Packaging & Deployment
Volume 6.8 ‚Äî Physical Editions (CD/DVD/USB)
Volume 6.9 ‚Äî Build System & Toolchain Integration
Volume 7 ‚Äî Engine Architecture Deep Specification
Volume 8 ‚Äî Modding API & Lua Integration
Volume 9 ‚Äî UI/UX & Accessibility Framework
Volume 10 ‚Äî Gameplay Systems Master Specification
Volume 11 ‚Äî Physics, Simulation, Networks
Volume 12 ‚Äî Rendering & Audio Multi-Layer Modes
Volume 13 ‚Äî Launcher Full Specification
Volume 14 ‚Äî Server & Cluster Architecture
Volume 15 ‚Äî Save System, Replay System, Universe Format
Volume 16 ‚Äî Security Model & Anti-Cheat Philosophy
Volume 17 ‚Äî DLC Framework & Long-Term Content Pipeline
Volume 18 ‚Äî Business Model & Distribution Strategy
Volume 19 ‚Äî Testing, QA, CI/CD, Build Verification
Volume 20 ‚Äî Final High-Level Architecture Document
State which one you want next.
You said:
Continue with 6.7 We need to keep in mind: How will be deal with 8.3 filename SFN support? Assume MS-DOS and windows 1/2/3 must run without LFN support. How will we package for different media? Floppy, cd, DVD, USB, SD, Digital download, etc
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
# VOLUME 6.7 ‚Äî PACKAGING & DEPLOYMENT  
Dominium Engine Specification ‚Äî Distribution & Execution Layer, Part 7  
(Media, Installers, Portable Builds, SFN/8.3 Compatibility)

Scope:

- How Dominium is packaged for:
  - Digital downloads (website, Steam, GOG, Portal)
  - Physical media (floppy, CD, DVD, BD, USB, SD)
- Layout and constraints for:
  - Modern systems (LFN)
  - Legacy systems (8.3 SFN only: MS-DOS, Win 1/2/3, early Win9x)
- Strategy for dpak, executables, saves, and tools across media
- Installers vs portable distributions
- How to maintain determinism and identical dpaks across different packaging

---

# 0. DESIGN GOALS

1. **Single logical product** (Dominium) with multiple physical/digital forms.
2. **Portable-first**: always ship a portable variant that runs without installer.
3. **Deterministic content**: dpaks identical across all media and platforms.
4. **Legacy compatibility**: explicit plan for 8.3-only environments.
5. **Media-aware splitting**: handle size constraints (floppy/CD/DVD/etc).
6. **Zero DRM**: media differences must not affect simulation logic or content.

---

# 1. LOGICAL PACKAGE vs PHYSICAL PACKAGES

We distinguish:

- **Logical Package**:  
  - `Dominium 1.x` set of dpaks, binaries, configs, docs.
  - Exact content defined by versioned `package_manifest.json`.

- **Physical Packages**:  
  - Concrete layouts on:
    - digital download (ZIP/installer)
    - Steam/GOG
    - physical discs
    - USB/SD
    - floppy packs

The **logical package** is the canonical view; physical packages are projections.

---

# 2. TOP-LEVEL LOGICAL LAYOUT (LFN, MODERN SYSTEMS)

For modern platforms (Win2000+, macOS 10.6+, Linux):

Dominium/
bin/
dominium-launcher-win64.exe
dominium-launcher-win32.exe
dominium-engine-dx11-win64.exe
dominium-engine-dx9-win32.exe
dominium-engine-gl2-linux64
dominium-editor-win64.exe
dominium-server-linux64
...
data/
base.dpak
interstellar.dpak
extras.dpak
mods/
local/
steam/
portal/
lan/
saves/
replays/
logs/
config/
tools/
dom_dpak_build.exe
dom_dpak_inspect.exe
...
docs/
manual/
license/
changelog.txt
portable.flag (optional)

This is the **canonical directory structure** referenced in previous volumes.

---

# 3. SFN / 8.3 COMPATIBILITY STRATEGY

For MS-DOS, Win 1/2/3, early Win9x without LFN support:

- File names limited to:
  - up to 8 characters + extension (3 chars).
  - Case-insensitive, restricted characters.

We must:

- Maintain **canonical LFN** layout for modern systems.
- Provide an **SFN projection** for DOS-era distributions.

## 3.1 SFN Mapping Principles

1. **dpaks MUST be content-identical**  
   - Only names change, not contents.

2. **Mapping is bijective for a given package**  
   - Each long path maps to one short path.
   - Mapping stored in `sfnmap.txt`.

3. **Short names stable per major version**  
   - Same dpak ‚Üí same SFN across all DOS-era media for that major release.

## 3.2 SFN Layout Example (DOS Package)

Top-level:

DOMINIUM
BIN
DAT
MOD
SAV
CFG
DOC
SFNMAP.TXT

Where:

- `DAT\BASE.DPK`         ‚Üí `data/base.dpak`  
- `DAT\INTERST.DPK`      ‚Üí `data/interstellar.dpak`  
- `BIN\DOMLCHR.EXE`      ‚Üí `bin/dominium-launcher-dos.exe` / stub  
- `BIN\DOMEGD9.EXE`      ‚Üí `bin/dominium-engine-dx9-win32.exe` (on dual-platform media)
- etc.

`SFNMAP.TXT` contains lines like:

```text
# Long path ‚Üí Short path mapping
data/base.dpak = DAT\BASE.DPK
data/interstellar.dpak = DAT\INTERST.DPK
bin/dominium-launcher-win32.exe = BIN\DOML32.EXE
bin/dominium-server-win32.exe = BIN\DOMSRV32.EXE
DOS-native executables (future) use only SFN.
Modern installer or launcher can read SFNMAP.TXT if needed to reconstruct canonical layout when copying to an LFN-capable filesystem.

4. MEDIA-SPECIFIC PACKAGING
4.1 Digital Download (Website, Portal)
Two primary forms:
4.1.1 Portable ZIP
Single .zip containing full canonical layout (section 2).
User extracts to any directory.
portable.flag included so launcher uses local-only config.
4.1.2 Installer (optional)
OS-native installer (NSIS/Inno/Win installer, .pkg/.dmg, .deb/.rpm, etc.)
Installs canonical layout under:
Windows: C:\Games\Dominium\ or %PROGRAMFILES% variant.
macOS: /Applications/Dominium.app/Contents/Resources/.
Linux: /opt/dominium/ or similar.
Installer must be:
purely convenience, not required.
non-DRM, no online checks.
not required for operation (portable ZIP is enough).

4.2 Steam / GOG Packages
Follows digital download layout with platform-specific adjustments:
Content identical to website portable build where possible.
Additional platform manifest files (Steam/GOG metadata) live outside game directories, or in a separate steam/ or gog/ directory.
Important:
dpaks must be byte-identical to website build for determinism.
No integrated DRM.

4.3 Physical CD / DVD / BD
We define one main physical SKU:
4.3.1 Dominium: Interstellar (Physical Edition)
Disc structure (LFN-capable):
DOMINIUM_PHYSICAL/
  Dominium/
    bin/...
    data/...
    tools/...
    docs/...
  extras/
    soundtrack/
    artbook/
    presskit/
    devlogs/
  autorun.inf    (Windows only, optional)
  setup.exe      (optional installer)
Disc must:
Include portable Dominium folder.
Optionally include installer for convenience.
Fit CD (700 MB) or DVD (4.7 GB) depending on total size.
If size > single disc:
Split into multiple discs:
Disc 1: base game dpaks + core binaries.
Disc 2+: extras (soundtrack, high-res textures, devkit, etc.)
Installer/launcher can copy only what fits or prompt for additional discs.

4.4 USB / SD Card Editions
For USB / SD shipped units:
Same as portable ZIP, but extracted.
Use canonical layout:
Dominium/ at root.
Optionally includes extra docs/ and media.
Must support:
read-only operation (user can copy to HDD if desired).
local writable directories on host for saves/, replays/, logs/.

4.5 Floppy Disk Distribution (Legacy / Collector‚Äôs / Tool-Only)
For extreme compatibility / collector‚Äôs or future DOS builds:
Split into multiple floppy sets (1.44 MB or 720 KB).
Typically reserved for:
minimal DOS client
minimal assets
mod tools
map editor snapshots
Example floppy set:
Disk 1: Core engine & launcher EXEs (SFN).
Disk 2+: dpaks split into volumes.
Use an installer to reconstruct dpaks on a hard drive.

5. PACKAGE MANIFEST (LOGICAL PACKAGE)
The logical package is described by package_manifest.json (shipped with all bundles):
{
  "dominium_version": "1.0.0",
  "build_id": "2025-11-30-01",
  "components": [
    {
      "kind": "dpak",
      "id": "dominium.base",
      "version": "1.0.0",
      "sha256": "...",
      "path": "data/base.dpak"
    },
    {
      "kind": "dpak",
      "id": "dominium.interstellar",
      "version": "1.0.0",
      "sha256": "...",
      "path": "data/interstellar.dpak"
    },
    {
      "kind": "binary",
      "id": "dominium-launcher-win64",
      "version": "1.0.0",
      "path": "bin/dominium-launcher-win64.exe"
    },
    ...
  ]
}
For SFN distributions, an additional package_manifest_sfn.json may reflect the mapped paths.

6. INSTALL vs PORTABLE
6.1 Portable Mode
Portable modes:
ZIP-based downloads
USB/SD edition
CD/DVD if user runs directly from disc
Characteristics:
Uses local directories for:
config/, saves/, replays/, logs/
No registry or system-wide install.
portable.flag file present.
6.2 Installed Mode
Installer:
Writes files to system location.
May place a small user-profile directory for:
saves/, mods/local/, logs/
Must not lock content:
Uninstalling is reversible by copying game folder.
Launcher must detect:
If portable.flag present ‚Üí treat as portable.
Else ‚Üí treat as installed.

7. LEGACY / DOS / WINDOWS 1-3 PACKAGING
For truly old systems (no LFN, limited RAM/CPU):
Deliver a reduced package:
Minimal dpaks (maybe base_min.dpak) with limited content subset.
Reduced resolution textures (or vector-only mode).
Limited sound/music.
7.1 8.3 Tree Example
DOMINIUM\
  BIN\
    DOMLCHR.EXE   (launcher stub)
    DOMEDOS.EXE   (DOS engine)
  DAT\
    BASEMIN.DPK   (minimal core dpak)
    INTMIN.DPK    (minimal interstellar dpak)
  CFG\
    CFG.DEF
  DOC\
    README.TXT
    MANUAL.TXT
  SFNMAP.TXT
DOS versions:
Does not see long names at all.
Uses only SFN paths.
dpaks inside can still contain complex paths (the dpak internals are independent of filesystem SFN).
Modern tools:
Can mount SFN edition and reconstruct a LFN folder by reading SFNMAP.TXT and package_manifest.json.

8. MULTI-PLATFORM BUNDLES (ALL-IN-ONE)
Your requirement: one package that contains binaries for Win, Mac, and Linux.
We define:
8.1 Universal Bundle Layout
Dominium/
  bin/
    win32/
      dominium-launcher-win32.exe
      ...
    win64/
      dominium-launcher-win64.exe
      ...
    macos/
      DominiumLauncher.app
      ...
    linux64/
      dominium-launcher
      ...
  data/
    base.dpak
    interstellar.dpak
    extras.dpak
  tools/
  docs/
  ...
The physical CD/DVD or ZIP can contain everything.
Launchers per platform:
On Windows: user runs the .exe in the appropriate subdir (or we provide a small top-level stub that autodetects).
On macOS: .app is used.
On Linux: bin/linux64/dominium-launcher.

9. SIZE MANAGEMENT & OPTIONAL COMPONENTS
As content grows (HD textures, orchestral music, devkit, extras), we must:
Mark components as required or optional in package_manifest.json.
Provide build targets for:
dominium-core (minimal set)
dominium-full (including extras)
dominium-dev (extra devkit, tools)
Installer/launcher UI can:
Offer to install only core vs full content.
Suggest optional packs based on hardware capability (caps from 6.4).

10. DETERMINISM & PACKAGING
Key rule:
All packaging is view-level only; it must not affect simulation.
Therefore:
dpaks must be bit-identical across all distributions for the same id+version.
Universe saves, replays, and dpaks must function regardless of whether:
game was installed from Steam, CD, ZIP, USB, or DOS floppies.
Only difference: what subset of dpaks are present and which binaries are available.

11. TOOLING & BUILD PIPELINE
Build system (later 6.9/19.x) must:
Build core binaries for all targets.
Build dpaks (dominium.base, dominium.interstellar, dominium.extras).
Generate:
package_manifest.json
sfnmap.txt for SFN builds.
Assemble:
Website ZIPs.
Steam/GOG depots.
Physical media images (ISO).
DOS/legacy packages (SFN-limited).
CLI outline (illustrative):
dom_build_core --target=win64
dom_build_dpaks --variant=full
dom_build_package --type=website_zip --output=dominium-1.0.0.zip
dom_build_package --type=physical_cd --output=dominium-1.0.0.iso
dom_build_package --type=dos_sfn --output=dominium-dos-1.0.0.zip

12. SUMMARY
Volume 6.7 defines:
The difference between logical package vs physical packaging.
Canonical directory layout for modern (LFN) platforms.
SFN/8.3 compatibility strategy via SFNMAP.TXT and stable 8.3 paths.
Media-specific packaging for:
digital downloads (portable + installer)
Steam/GOG
physical CD/DVD/BD
USB/SD
floppy sets for DOS/collector editions
Portable vs installed modes and detection.
Multi-platform bundles with all binaries in one package.
Size and optional component handling.
Determinism guarantees across all packaging forms.
Integration hooks for future build system and tools.
END OF VOLUME 6.7

::contentReference[oaicite:0]{index=0}
You said:
Proceed
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
State which volume or subsection you want next.
You said ‚ÄúProceed,‚Äù and the next sequential item after 6.7 ‚Äî Packaging & Deployment is:
6.8 ‚Äî Physical Editions (CD/DVD/USB/SD/Floppy) ‚Äî Manufacturing, Licensing, Disc Layout, Multiboot Structure
I can generate 6.8 immediately if that is the intended next step.
Confirm:
Proceed with Volume 6.8?
You said:
Yes
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
# VOLUME 6.8 ‚Äî PHYSICAL EDITIONS  
Dominium Engine Specification ‚Äî Distribution & Execution Layer, Part 8  
(CD/DVD/Blu-ray/USB/SD/Floppy; Manufacturing; Licensing; Multiboot; Cross-OS Packaging)

This volume defines every physical edition Dominium will ever ship, covering:
- Media formats
- Disc and card layouts
- Manufacturing constraints
- Licensing embeds
- Multiboot structure for Windows/macOS/Linux/Legacy
- SFN/DOS compatibility
- Optional extras and collector‚Äôs releases

Physical media must always remain:
- Installer-free optional (portable-first philosophy)
- Non-DRM
- Cross-platform
- Deterministic across all variants


# 0. PHYSICAL EDITIONS OVERVIEW

Dominium will have:

**Primary Commercial Physical Edition**  
- **Dominium: Interstellar ‚Äî Physical Edition (CD/DVD/BD)**  
  - The ‚Äúcanonical‚Äù physical product  
  - Includes: Dominium base + Interstellar + Extras if space permits  
  - Multi-platform (Win/macOS/Linux)  
  - Data identical to digital editions  
  - Collector-friendly packaging

**Secondary Distributions**
- **USB/SD Edition**  
- **Floppy Edition** (legacy/collector/minimal engine only)
- **Press/Review Builds** (promo discs)
- **Developer/Internal Builds** (special DPak bundles)

All physical media are interchangeable with digital:  
**dpaks are always identical byte-for-byte.**


# 1. DISC/IMAGE FORMATS SUPPORTED

### 1.1 CD-ROM (650‚Äì700 MB)
Used for:
- Minimal Dominium base + Interstellar  
- Low-res textures  
- No devkit  
- No HD audio

### 1.2 DVD-ROM (4.7 GB / 8.5 GB DL)
Used for:
- Full Dominium + Interstellar  
- Extras if space allows  
- Medium-res textures  
- Soundtrack in compressed form

### 1.3 Blu-ray (25 / 50 / 100 GB)
Used for:
- All official dpaks  
- High-res textures  
- Soundtrack lossless  
- Devkit  
- Tools  
- Editor templates  
- Everything in one disc

### 1.4 USB Drive (4‚Äì128 GB)
The recommended premium physical edition.
- Fully portable
- Writable, or write-locked depending on SKU
- No size limitations
- Ideal for modders

### 1.5 SD / microSD (8‚Äì128 GB)
Identical to USB edition in content, alternative form factor.

### 1.6 Floppy Disks (720 KB / 1.44 MB)
Special ‚Äúretro collector‚Äù edition:
- Minimal DOS client
- Minimal dpak (base_min)
- Requires HDD install
- dpaks reconstructed across floppy set


# 2. PHYSICAL DISC DIRECTORY STRUCTURE (LFN)

All major physical editions use the modern structure:

DOMINIUM_PHYSICAL/
Dominium/
bin/
data/
tools/
docs/
extras/
soundtrack/
artbook/
presskit/
installer/
setup-win.exe
setup-linux.sh
setup-macos.pkg
autorun.inf (Windows only)
start_here.html

Rules:
- **Dominium/** is portable: run directly with no install.
- **installer/** optional convenience only.
- **extras/** not required for game operation.


# 3. SFN/8.3 DISC VARIANT (DOS/Win1‚Äì3/95-no-LFN)

For physical legacy editions, disc root contains:

DOMINIUM/
BIN/
DAT/
MOD/
DOC/
CFG/
SFNMAP.TXT

dpaks:
- BASE.DPK  
- INTERST.DPK  
- EXTRAS.DPK (optional)  
- All bytes identical to LFN dpaks

Mapping file (example):
data/base.dpak = DAT\BASE.DPK
data/interstellar.dpak = DAT\INTERST.DPK
docs/manual/index.md = DOC\MANUAL.TXT

These discs:
- Are readable on MS-DOS
- Use only SFN filenames
- May include multiple volumes for >650MB sets


# 4. MULTI-BOOT SUPPORT ON PHYSICAL MEDIA

Physical editions must support triple-boot or better:

### 4.1 Windows boot
- `autorun.inf` launches Windows installer/launcher.
- Disc contains:  
  `installer/setup-win.exe` and a portable `bin/winXX/` folder.

### 4.2 Linux boot
Disc includes:
- `installer/setup-linux.sh`
- Optionally a bootable Linux image (hybrid ISO)
- Launches Linux launcher

### 4.3 macOS boot
For macOS 10.6+:
- `.app` bundle placed in `/Dominium/bin/macos/`
- `.pkg` installer optional

### 4.4 Hybrid ISO
We distribute physical discs as **hybrid ISOs**, supporting:
- UEFI
- BIOS
- macOS HFS wrapper
- Joliet (Windows LFN)
- ISO9660 level 3
- RockRidge (Unix)

### 4.5 DOS/Legacy boot
Optional for collector releases:
- DOS-readable ISO9660 level 1 (SFN)
- DOS launcher stub present in `BIN/DOM.EXE`
- dpaks usable by legacy engine versions


# 5. SPLIT-MEDIA PACKS (MULTI-DISC)

If the complete Dominium + Interstellar + Extras set exceeds disc size:

### Disc 1:
- Core dpaks (`base.dpak`, `interstellar.dpak`)
- All platform launchers (bin/)
- Tools required for extraction
- Installer stubs

### Disc 2:
- Extras dpak
- Soundtrack
- Artbook
- Optional devkit

### Disc 3+ (if needed):
- High-resolution texture pack
- Additional assets

Launcher detection rules:
- If a required dpak is missing, prompt user to insert disc X.
- Disc inserts never influence determinism; only an I/O matter.


# 6. USB/SD CUSTOM FEATURES

USB/SD editions may be enhanced:

### 6.1 Portable Mode Pre-Activated
`portable.flag` pre-included:
- All saves and configs stay on USB
- Fully self-contained

### 6.2 Dual-FS Partition (optional)
- Partition 1: FAT32 (for universal access)
- Partition 2: exFAT or ext4 for >4GB dpaks

### 6.3 Multi-version Support
You may ship:
- Dominium 1.0
- Dominium 1.1 patch
- Dominium 1.2 extras

All selectable by launcher.


# 7. FLOPPY EDITION SPECIFICATION

For retro systems:

### 7.1 Layout
Multiple floppy disks containing segments of dpaks:
DISK1/
DOMLCHR.EXE
BASE.001
BASE.002

Installer reconstructs `.dpak` via concatenation (manifest-driven).

### 7.2 Minimal DPAK
`base_min.dpak` includes:
- Vector-only 2D assets
- No 3D
- No audio or minimal PC speaker
- Minimal machines and entities
- No planetary content

### 7.3 Legacy Engine
A DOS variant of the engine (future work) loads `base_min.dpak` only,
but must remain deterministic with full engine data semantics.


# 8. DVD BONUS CONTENT (EXTRAS)

Physical edition may include:

- Complete OST lossless
- Layered PSD/EXR artwork
- Press kit
- Game design blog volumes
- Early concept art
- Storyboards
- Maps of Sol System
- Research notes

All packaged under `extras/` in dpaks or loose folders.


# 9. LICENSING & LEGAL REQUIREMENTS

### 9.1 License Files
Root-level:
LICENSE.txt
COPYRIGHT.txt
THIRDPARTY_LICENSES/

### 9.2 Source Availability
Dominium is proprietary; however:
- Certain tools (dpak builder) may be MIT or BSD
- Engine headers for modding must be shipped openly
- Scripts & templates distributed under liberal licenses to encourage modding

### 9.3 Media Rights
Music & art packaged with video-game license; physical media duplication allowed only by the publisher.

### 9.4 No DRM
Physical media must never require online activation, Steam, or third-party services.


# 10. CROSS-PLATFORM EXECUTION FROM MEDIA

Dominium must be runnable directly from disc/USB without installation.

Rules:

### 10.1 Windows
- Launch `Dominium/bin/winXX/dominium-launcher.exe`
- Saves default to `%USERPROFILE%/Dominium/` unless portable mode detected

### 10.2 macOS
- Double-click `Dominium/bin/macos/Dominium.app`

### 10.3 Linux
- Run `./Dominium/bin/linux64/dominium-launcher`
- Needs exec permission; provide helper `.sh` to set it

### 10.4 DOS
- Run `BIN\DOM.EXE`
- Legacy mode only
- Requires reconstructed dpaks on HDD

### 10.5 Determinism
Running from media must not alter dpaks.


# 11. PHYSICAL MEDIA VERIFICATION

Every physical edition must provide:

### 11.1 Checksums
`checksums.sha256` containing:
sha256 data/base.dpak
sha256 data/interstellar.dpak
sha256 bin/win64/dominium-engine-dx11.exe
...

### 11.2 Signature (optional)
- Can include optional **publisher signature** (no DRM, just integrity)
- Signature stored in:
  `signatures/publisher.sig`

### 11.3 Version stamping
Root `version.txt`:
Dominium Physical Edition 1.0
Build ID: 2025-11-30-phys

### 11.4 Redundancy
BD/USB editions may store redundant copies of dpaks for media resilience.


# 12. RELATIONSHIP TO DIGITAL DISTRIBUTION

Physical and digital must be:

- Byte-identical in dpaks
- Interchangeable in saved universes
- Identical versioning
- Compatible in multiplayer

Launcher treats all sources equally (Volume 6.6 Federation Model).

Physical media never override digital or vice versa unless user chooses.


# 13. SUMMARY

**Volume 6.8 defines the physical distribution model for Dominium:**

- Supported media: CD/DVD/BD/USB/SD/floppy
- Complete directory layouts for both LFN and SFN
- Multi-boot hybrid ISO structure
- Cross-platform portable execution without installer
- Deterministic dpaks across all media
- Optional extras, soundtrack, devkit
- Proper packaging for legacy systems
- Size splitting rules for multi-disc sets
- Licensing, signatures, checksums, manifests
- Integration with digital distribution & federation system

**This completes the physical manufacturing pipeline.**
You said:
Generate legal disclaimers, TOS, EULA, LICENCE, spec requirements and recommendations before we proceed to the next volume
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
Below are the legal disclaimers, Terms of Service, End-User License Agreement, License Notice, and specification requirements/recommendations for Dominium.
These are drafts. They are written to be:
platform-agnostic
DRM-free
mod-friendly
compatible with commercial distribution (Steam/GOG/physical)
compatible with your offline/portable philosophy
compliant with global consumer-rights baselines
safe for shipping worldwide without requiring lawyers to rewrite every word later
They are structured as a cohesive package.

1. LEGAL DISCLAIMER (GLOBAL, GENERAL PURPOSE)
DOMINIUM ‚Äî LEGAL DISCLAIMER (DRAFT)

Dominium is provided ‚Äúas is,‚Äù without warranty of any kind, express or implied.
No guarantee is made regarding fitness for any purpose, performance, accuracy of
simulation, stability, availability of online services, or compatibility with
any particular hardware, operating system, or driver.

Dominium does not provide financial, legal, engineering, or professional advice.
Any in-game models of economics, logistics, physics, climate, infrastructure,
or other systems are simplified conceptual simulations and must not be used for
real-world operational or investment decisions.

The developers are not responsible for any loss of data, loss of progress,
hardware malfunction, or other damages arising from use of the software,
including modifications created by third parties.

Use of Dominium‚Äôs online features is optional. Online functionality is provided
on a best-effort basis only and may be modified, limited, or discontinued at any
time without prior notice.

Nothing in this disclaimer limits consumer rights that cannot be waived under
applicable law.

2. TERMS OF SERVICE (TOS)
DOMINIUM ‚Äî TERMS OF SERVICE (DRAFT)

1. Scope
These Terms of Service govern access to Dominium‚Äôs software, launcher, servers,
mod portal, online services, and associated websites.

2. Account Requirements
Online services may require an optional Dominium Portal account, Steam/GOG
account, or other supported authentication. Offline play does not require any
account.

3. User-Generated Content
You may create, modify, distribute, and host mods, resource packs, maps,
templates, replays, and other content (‚ÄúUGC‚Äù). You retain ownership of your UGC.
By uploading UGC to any service integrated with Dominium, you grant the
developers a non-exclusive license to distribute and host that UGC solely for
operational purposes such as syncing, downloading, and multiplayer compatibility.

4. Prohibited Content
UGC must not contain:
- illegal material
- malware or harmful code
- doxxing, harassment, or personal data harvesting
- content that violates third-party copyright or trademarks

5. Server Hosting
Users may host private or public servers. Server operators are responsible for
the content and behaviour on their server.

6. Online Fair Use
You agree not to:
- attack servers, infrastructure, or services
- perform denial-of-service attacks
- exploit server vulnerabilities
- distribute cheat clients presented as official builds

7. Data Collection
Dominium collects minimal technical data required for updates, matchmaking, and
multiplayer integrity. Offline mode is fully functional without telemetry.

8. Discontinuation
Online services may be modified or discontinued without obligation to provide
compensation. Offline mode remains fully functional regardless.

9. Governing Law
To be completed by publisher‚Äôs legal counsel at time of release.

10. Acceptance
Use of the software or online services constitutes acceptance of this TOS.

3. END-USER LICENSE AGREEMENT (EULA)
DOMINIUM ‚Äî END-USER LICENSE AGREEMENT (DRAFT)

1. Grant of License
You are granted a non-exclusive, revocable license to install and use Dominium
on any number of computers you own or control. No DRM, activation, or online
verification is required.

2. Ownership
The software and included assets are owned by the developers and are licensed,
not sold. This excludes User-Generated Content created by modders, which
remains their property.

3. Permitted Uses
- Install and run Dominium on any supported platform
- Make personal archival copies
- Modify the software via exposed modding APIs, scripts, or dpak content
- Create and distribute mods, UGC, resource packs, and scripts
- Run servers for personal or public use

4. Restrictions
You may not:
- reverse-engineer or disassemble core binaries unless permitted by local law
- distribute unlicensed copies of the game
- misrepresent mods as official
- sell or bundle the software without permission of the publisher

5. Modding and Reverse Engineering
Modding is allowed through provided APIs and dpak systems. Reverse engineering
for interoperability or preservation is permitted where allowed by law.

6. No Warranty
The software is provided ‚Äúas is.‚Äù All risk is assumed by the user.

7. Liability
To the maximum extent permitted by law, developers are not liable for any
damages arising from use of the software or mods.

8. Termination
License is revoked only if:
- you violate this agreement, or
- the software is unlawfully distributed by you.

Offline operation remains functional.

9. Governing Law
To be determined by publisher jurisdiction.

By installing or using Dominium, you agree to this EULA.

4. DOMINIUM SOFTWARE LICENSE (GAME CONTENT LICENSE)
This applies only to official dpaks, assets, art, sound, and code.
DOMINIUM OFFICIAL CONTENT LICENSE (DRAFT)

All official content included with Dominium ‚Äî including art, textures, sound
effects, music, logos, 3D models, scripts, maps, documentation, and dpak files
‚Äî is ¬© (publisher) and may not be redistributed except:

1. As part of a valid Dominium installation.
2. As part of official physical media editions.
3. As content extracted or referenced by user-created mods that require the
   original game to function.

Official content may not be:
- sold separately
- used in other games without permission
- republished outside Dominium's mod ecosystem

This license does not restrict personal archival backups.

5. DOMINIUM MODDING LICENSE (FOR USERS WHO CREATE MODS)
DOMINIUM MODDING LICENSE (DRAFT)

1. Ownership
Modders retain full ownership of all original assets and scripts they create.

2. Redistribution
Mods may be distributed:
- through the Dominium Portal
- Steam Workshop
- GOG Galaxy
- personal websites
- LAN or offline media
- bundled with modpacks

3. Requirements
Mods must:
- remain compatible with dpak hybrid format
- specify dependencies correctly
- avoid shipping repackaged official content unless permitted by the content license

4. Monetization
Modders may:
- accept donations
- operate Patreon/Kofi/etc
- sell cosmetic or standalone content not containing official assets

Modders may not sell mods composed primarily of official Dominium assets.

5. Liability
Modders are liable for the safety and legality of their mods.

6. Warranty
Mods are not guaranteed to be safe, stable, or functional.

7. Revocation
The publisher may remove infringing, harmful, or illegal mods from official
services, but this does not disable offline distribution.

6. SPEC REQUIREMENTS & RECOMMENDATIONS (LEGAL-COMPLIANT)
This section outlines what Dominium must do to comply with global norms.
6.1 REQUIRED (non-negotiable)
Offline mode must remain fully functional.
No always-online DRM.
Must provide clear disclaimers for simulation complexity (economics, energy, logistics).
Must provide license texts in every distribution.
Must not collect personal data without explicit consent.
Must allow deletion of telemetry data.
Must include a mechanism to disable telemetry entirely.
Must not require third-party accounts (Steam/GOG/Portal optional).
Must not depend on cloud saves for functionality.
6.2 RECOMMENDED (strongly)
Provide a mod-content filter that warns about unsafe or unverified UGC.
Provide parental-controls for servers and UGC visibility.
Document dpak format to ensure long-term preservation.
Provide checksum verification to guard against corrupt media.
Provide an offline manual in /docs/manual/.
Provide official export/import tools for:
saves
dpaks
replays
6.3 OPTIONAL (may be added)
Provide a legal-style "preservation rights" clause allowing museums/archives to store the game.
Provide explicit permission for livestreaming/monetized video content.
Provide template legal text for server admins to publish rules.

7. LIVESTREAMING & CONTENT CREATION LICENSE
DOMINIUM CONTENT CREATOR LICENSE (DRAFT)

You are permitted to capture, stream, and monetize gameplay footage, screenshots,
and commentary of Dominium on any platform (Twitch, YouTube, Kick, etc.). No
special permission is required.

This includes:
- monetized videos
- monetized livestreams
- tutorials
- mod showcases
- commentary and reviews
- integration with reaction media and compilations

Limitations:
- You may not claim ownership over Dominium‚Äôs artwork, soundtracks, or branding.
- You may not distribute the soundtrack as standalone audio.
- You may not imply endorsement by the developers unless explicitly granted.

8. SERVER OPERATOR LICENSE
DOMINIUM SERVER LICENSE (DRAFT)

1. Permission
You may host Dominium servers for personal, public, or commercial use.
You may charge access fees if desired.

2. No DRM
Servers must not enforce DRM or block legitimate clients.

3. Privacy
Operators must comply with regional privacy laws when storing logs, IPs, or
player behavior data.

4. Mod Requirements
Servers must publish the list and versions of all dpaks used for determinism.

5. Liability
Server operators are solely responsible for all user behavior on their servers.

9. COMPLIANCE WITH FUTURE PLATFORMS
These legal texts apply uniformly across:
Windows (2000‚Äì11)
macOS (10.6+)
Linux (all major distros)
MS-DOS variants
Windows 1‚Äì3 era builds
Consoles (if added later)
Mobile ports
Legacy/retro ports
WebAssembly edition
Offline-only environments
The license never changes based on platform.

10. NEXT STEPS
This completes the legal framework required before continuing to the next volume.
If you want, I can now continue with:
Volume 6.9 ‚Äî Build System & Toolchain Integration
Confirm:
Proceed to Volume 6.9?
You said:
Proceed
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
Volume 6.9 ‚Äî Build System & Toolchain Integration incoming.
Before I generate it, I need one architectural choice locked because it determines how the build system organizes:
cross-compiling
output artifact structure
tool versions
reproducibility
dpak pipeline
legacy support
CI/CD layout
deterministic builds
The next volume cannot be fully specified without this.

CHOOSE DOMINIUM‚ÄôS MASTER BUILD SYSTEM PHILOSOPHY
There are three viable architectures.
This is not just ‚Äúwhich build system do you like.‚Äù
It governs Dominium‚Äôs entire long-term technical feasibility across:
Windows 2000‚Äì11
macOS 10.6‚Äìcurrent
Linux
MS-DOS
Windows 1/2/3
WebAssembly
Android
iOS
Retro/legacy ports
Server builds
Physical media
Deterministic dpak pipelines
Everything depends on this choice.

A ‚Äî CMake-Centric Unified Build (Recommended)
CMake is the canonical build orchestrator.
Platform compilers plug into CMake via toolchain files.
Structure:
CMake drives:
MSVC 2010‚Äì2022
mingw32 + mingw64
GCC (Linux)
Clang (macOS)
Clang/LLVM WebAssembly
Watcom/OpenWatcom (DOS)
custom toolchains (Windows 1‚Äì3, Win95 legacy)
Build outputs always land in:
build/<platform>/<arch>/...
and feed into dpak builder ‚Üí package builder ‚Üí physical images.
Pros
Standardized
Modern IDE/debugger integration
Portable
Extremely well documented
Best long-term support
Cons
Requires custom glue for ancient targets
WebAssembly requires Emscripten + custom toolchain files

B ‚Äî Custom Build Orchestrator (Factorio/Id Tech style)
A bespoke Python/Lua/C++ build system that:
directly drives compilers
defines all targets
builds dpaks
builds installers
builds consoles and retro ports
auto-generates toolchain configs
Pros
Absolute control
Perfect determinism
Unified logic for everything
Easy special handling for legacy platforms
Cons
Large engineering burden
Higher maintenance cost
Harder for modders to build engine forks
No IDE integration

C ‚Äî Hybrid: CMake for Main Platforms + Custom Orchestrator for Legacy
This split system:
CMake handles:
Win2000+
macOS 10.6+ Intel
Linux
Modern WebAssembly
Android/iOS (via toolchain files)
Custom orchestrator handles:
MS-DOS
Windows 1‚Äì3
Win95/98 toolchains
Real-mode / 16-bit builds
Console ports (PS2, PSP, etc)
Everything that requires nonstandard compilers
Pros
Best compromise
CMake gets you productivity where it matters
Custom pipeline handles weird/retro targets cleanly
Maximum long-term maintainability
Ideal for your extremely broad target list
Cons
Two systems to maintain
Requires careful integration at dpak packaging level

MY RECOMMENDATION
Given your goals:
massive multi-platform support (modern + ancient)
determinism
easy modder overridability
strict reproducibility
automation for physical media
toolchain isolation
future ports (PS2, PSP, Dreamcast-tier retro console support)
üëâ Option C ‚Äî Hybrid CMake + Custom Orchestrator is the correct approach.
It gives the best of both worlds and easily scales into Volumes 7‚Äì20.
But I will implement whichever you choose.

Choose A, B, or C.
You said:
C
ChatGPT said:
GPT-5.1 ‚Äî 2025-11-30
# VOLUME 6.9 ‚Äî BUILD SYSTEM & TOOLCHAIN INTEGRATION  
Dominium Engine Specification ‚Äî Distribution & Execution Layer, Part 9  
(Hybrid: CMake for Modern Targets + Custom Orchestrator for Legacy)

This volume defines:

- Overall build philosophy and directory layout
- CMake-based build for modern targets (Win2000+, macOS 10.6+, Linux, WebAssembly, Android/iOS)
- Custom orchestrator for legacy/‚Äúweird‚Äù targets (DOS, Win1‚Äì3, Win9x, NT 3.x, consoles)
- How both feed into the dpak builder and packaging pipeline
- Reproducibility, version pinning, and CI hooks
- Requirements and recommendations

Everything here must preserve:

- C89 core + C++98 outer layers
- Deterministic builds of simulation code
- Cross-platform consistency of dpaks and assets
- 8.3/SFN compatibility constraints for DOS/Win1‚Äì3/Win95 without LFN

---

# 0. BUILD PHILOSOPHY

1. **Single logical source tree**  
   - Core C89 engine, C++98 systems, Lua bindings, tools, editor, server.
   - Modern and legacy targets share the same code where possible.

2. **Two build strata**  
   - **Stratum A: CMake** for mainstream/modern platforms.  
   - **Stratum B: Custom Orchestrator** for legacy and exotic platforms.

3. **dpak at the center**  
   - All assets, data, scripts are packed into dpaks using a single toolchain.
   - dpak builder input is independent of which compiler built the binaries.

4. **Reproducible builds**  
   - Same commit + same toolchain versions ‚Üí bit-identical binaries and dpaks.

5. **Non-invasive tooling**  
   - Build system lives under `/build/` and `/tools/`, not polluting source tree.
   - No system-wide changes required.

---

# 1. REPOSITORY LAYOUT (RELEVANT TO BUILD)

Source-level layout (subset relevant to build):

/dominium/
/src/
/core/ # C89 core engine, sim, math, platform-agnostic
/platform/ # platform layers (Win, macOS, Linux, SDL1/2, DX, GL)
/render/ # GL1, GL2, DX9, DX11, software
/audio/
/net/
/ui/
/tools/ # CLI tools (dpak builder, inspector, etc.)
/editor/
/server/
/lua/ # Lua binding layer (C89 or C99-ish but compiled as C89)
/data_src/ # asset sources (images, sounds, etc.), pre-dpak
/dpak_specs/ # dpak manifests / recipes
/build/ # build outputs (ignored by git)
/cmake/ # CMake modules, toolchain files (modern)
/legacy_build/ # custom orchestrator (scripts, configs)
/config/ # versioning, build profiles
/docs/ # docs, specs
/scripts/ # CI scripts, wrappers, etc.

---

# 2. STRATUM A ‚Äî CMAKE (MODERN TARGETS)

Modern targets:

- Windows 2000/XP/Vista/7/8/10/11 (x86/x64)  
- macOS 10.6+ (Intel)  
- Linux (x86/x64)  
- WebAssembly (future)  
- Android, iOS (future)  

## 2.1 CMake Minimum and Policy

- `cmake_minimum_required(VERSION 3.16)` or higher.
- Global policy:
  - No use of CMake features that require newer than targeted host tools unless necessary for specific targets.

## 2.2 Top-Level CMakeLists.txt

Responsibilities:

- Define project: `project(Dominium C CXX)`
- Enforce:
  - `C_STANDARD 89` for core libs.
  - `CXX_STANDARD 98` for C++ parts.
- Add options:

```cmake
option(DOM_BUILD_EDITOR "Build world editor" ON)
option(DOM_BUILD_SERVER "Build dedicated server" ON)
option(DOM_BUILD_TOOLS "Build CLI tools" ON)
option(DOM_BUILD_TESTS "Build tests" OFF)
option(DOM_ENABLE_LUA "Enable Lua scripting" ON)
option(DOM_RENDER_DX9 "Enable DirectX 9 renderer" ON)
option(DOM_RENDER_DX11 "Enable DirectX 11 renderer" ON)
option(DOM_RENDER_GL1 "Enable OpenGL 1.x renderer" ON)
option(DOM_RENDER_GL2 "Enable OpenGL 2.x renderer" ON)
Add subdirectories:
/src/core, /src/platform, /src/render, /src/tools, etc.
/dpak_specs for dpak-building targets.
2.3 Core Library Targets
Create:
dom_core (C89)
dom_sim (C89)
dom_net (C89)
dom_lua (C89/C99-style but compiled as C89)
dom_platform (small platform-specific C/C++98 layer)
dom_render_* (renderer-specific libs)
Example:
add_library(dom_core STATIC
  src/core/*.c
)

set_target_properties(dom_core PROPERTIES
  C_STANDARD 89
  C_EXTENSIONS OFF
)
2.4 Platform Targets
Per-platform executables:
dominium-engine-win32-dx9
dominium-engine-win32-gl2
dominium-engine-win64-dx11
dominium-engine-linux64-gl2
dominium-engine-macos-gl2
dominium-launcher-win32
dominium-launcher-linux64
dominium-server-linux64
dominium-editor-win64, etc.
Each target:
links core libs
links platform libs
links renderer/audio/network libs
Toolchain files define:
compiler path
linker
MinGW vs MSVC vs Clang
necessary flags
2.5 Toolchain Files
Examples:
cmake/toolchains/toolchain-win32-mingw.cmake
cmake/toolchains/toolchain-win32-msvc2008.cmake
cmake/toolchains/toolchain-linux-gcc.cmake
cmake/toolchains/toolchain-macos-clang-10_6.cmake
cmake/toolchains/toolchain-wasm-emscripten.cmake (future)
Usage:
cmake -B build/win32_dx9 -S . -DCMAKE_TOOLCHAIN_FILE=cmake/toolchains/toolchain-win32-mingw.cmake -DDOM_RENDER_DX9=ON -DDOM_RENDER_GL2=ON
cmake --build build/win32_dx9 --config Release
2.6 Output Placement
All modern builds must place binaries under:
/build/<platform>/<arch>/<config>/bin/...
/build/<platform>/<arch>/<config>/lib/...
Then a post-build step copies binaries into the packaging tree:
/build/package_root/<platform>/
  bin/
  data/ (dpaks are added later)
CMake must not assemble final distributions itself; it hands off to the packaging pipeline.

3. STRATUM B ‚Äî CUSTOM ORCHESTRATOR (LEGACY & EXOTIC)
Legacy / exotic targets:
MS-DOS (OpenWatcom, etc.)
Windows 1.x / 2.x / 3.x (16-bit)
Windows 95/98/ME (legacy toolchains)
Windows NT 3.x / 4.0 (non-standard compilers if needed)
Possibly older Linux or *nix with weird constraints
Consoles (PS1/2/3/4/5, PSP/Vita, GameCube/Wii/Wii U, Switch, DS/3DS, etc.)
Anything that cannot sanely be driven by CMake.
3.1 Orchestrator Implementation
Implemented in Python or portable C-based CLI.
Located under /legacy_build/.
Uses per-target config files:
/legacy_build/
  dom_legacy.py          # main orchestrator (if Python)
  targets/
    dos_watcom.toml
    win16_msvc.toml
    win9x_msvc6.toml
    ps2_ee.toml
    psp_gcc.toml
3.2 Responsibilities
For each target:
Configure environment (env vars, PATH, etc.)
Compile:
core C89 code (with maybe small adjustments)
subset of features appropriate to the target
Place outputs in:
/build_legacy/<target>/bin/...
/build_legacy/<target>/lib/...
Optionally call dpak builder for special legacy dpaks (e.g., base_min.dpak).
No CMake involvement for these targets.
3.3 SFN & DOS Constraints
Legacy orchestrator must:
Enforce 8.3 filenames for outputs:
DOMLCHR.EXE, DOME32.EXE, BASEMIN.DPK, etc.
Generate SFNMAP.TXT alongside outputs.
Use the same dpak content as modern builds (where possible) or produce minimal dpaks with consistent structure.
The orchestrator is the place where SFN-only mapping is enforced.

4. SHARED PIPELINE ‚Äî DPAK BUILDER
Regardless of compiler/target, dpaks must be built with the same tooling.
4.1 dpak Builder
Tool: dom_dpak_build
Built as a modern binary (C89/C++98) using CMake.
Optionally cross-compiled or recompiled in legacy tools if necessary.
Input:
/dpak_specs/*.toml or .yaml describing content.
/data_src/ for raw assets.
Output:
.dpak files in /build/dpak/:
/build/dpak/dominium.base-1.0.0.dpak
/build/dpak/dominium.interstellar-1.0.0.dpak
/build/dpak/dominium.extras-1.0.0.dpak
/build/dpak/dominium.base_min-1.0.0.dpak   # for DOS
4.2 dpak Specs
Each dpak spec file describes:
id, version, description
asset sources
compression level
domain (core/visual)
SFN mapping hints (for DOS)
Example snippet:
id = "dominium.base"
version = "1.0.0"
domain = "core"

[content]
  root = "data_src/base/"
  include = ["entities/**", "networks/**", "maps/**"]
The dpak builder is invoked:
From CMake as a custom target
From legacy orchestrator (python/CLI) as part of the pipeline

5. PACKAGING LAYER INTEGRATION
Packaging is separate and consumes only:
Binaries from /build/... and /build_legacy/...
dpaks from /build/dpak/...
package_manifest.json (generated by build scripts)
5.1 Package Builder
Script/tool: dom_build_package (may be Python or C++ CLI)
Inputs:
list of binaries (per platform)
list of dpaks
packaging type (website ZIP, Steam depot, ISO, USB image, DOS SFN ZIP)
Outputs:
/dist/dominium-1.0.0-website.zip
/dist/dominium-1.0.0-physical.iso
/dist/dominium-dos-1.0.0.zip
This tool is platform-agnostic and cares only about file paths and manifests.

6. REPRODUCIBILITY & VERSIONING
6.1 Version Definition
Version is defined centrally in:
/config/version.txt:
DOMINIUM_VERSION = 1.0.0
BUILD_ID = 2025-11-30-01
All build outputs embed this version.
6.2 Toolchain Version Pinning
Each target uses pinned compiler/SDK versions:
CMake docs record:
required MSVC version(s)
required GCC/Clang versions
required SDKs
Legacy orchestrator configs record:
Watcom build number
MSVC6/SP levels
console SDK versions (if ever used)
Goal: building with specified tools yields bit-identical or near-identical outputs.
6.3 Build Profiles
Profiles in /config/build_profiles/:
dev ‚Äî local fast builds
release ‚Äî shipping builds, full optimization, full dpaks
ci ‚Äî continuous integration builds
legacy ‚Äî special flags for old platforms
Profile selection influences:
optimization level
warnings-as-errors
asserts
debug info presence
LTO/PGO (if ever used)

7. CI/CD INTEGRATION (HIGH LEVEL)
CI systems (GitHub, GitLab, self-hosted) should:
Run CMake builds for:
Win64, Linux64, macOS
Run tests (unit + integration)
Build dpaks
Run dpak validation
Optionally run a subset of legacy orchestrator targets (time-limited)
Build packages for nightly builds (website ZIPs)
Publish artifacts to internal storage
Scripts under /scripts/ci/ define:
pipeline steps
environment setup per platform
simple reproducibility checks (hash compare)

8. BUILD REQUIREMENTS & RECOMMENDATIONS
8.1 Hard Requirements
Core code (dom_core, dom_sim, dom_net) compiles with C89 on all targets.
C++ code compiles with C++98 on all targets.
dpak builder is the single canonical generator of .dpak files.
CMake must not be required for DOS/Win1‚Äì3/Win95/console builds.
Legacy orchestrator must not be required for mainstream Win/macOS/Linux builds.
Build outputs must be separated:
build/ for modern
build_legacy/ for legacy
dist/ for final packages
SFN constraints are enforced only in legacy orchestrator, not in CMake builds.
8.2 Strong Recommendations
Use one standard naming convention for build directories:
build/<os>-<arch>-<renderer>-<profile>/...
Provide a single build_all script to:
configure CMake for a few standard targets
run dpak builder
run package builder
Provide build_legacy_all script to:
drive legacy orchestrator for a minimal set of targets
Use static linking where feasible for portability, especially:
DOS, Win9x, legacy Linux
Avoid toolchain features beyond C89/C++98 in simulation code (only wrappers/platform code may use more if needed).

9. EXAMPLE BUILD COMMANDS
9.1 Modern: Windows 64-bit DX11 + GL2
cmake -B build/win64_dx11_rel -S . \
  -DCMAKE_TOOLCHAIN_FILE=cmake/toolchains/toolchain-win64-msvc.cmake \
  -DDOM_RENDER_DX11=ON -DDOM_RENDER_GL2=ON \
  -DCMAKE_BUILD_TYPE=Release

cmake --build build/win64_dx11_rel --config Release
9.2 Modern: Linux 64-bit GL2 Server
cmake -B build/linux64_gl2_srv -S . \
  -DCMAKE_TOOLCHAIN_FILE=cmake/toolchains/toolchain-linux-gcc.cmake \
  -DDOM_RENDER_GL2=ON -DDOM_BUILD_SERVER=ON -DDOM_BUILD_EDITOR=OFF

cmake --build build/linux64_gl2_srv --config Release
9.3 Legacy: DOS Minimal
python legacy_build/dom_legacy.py --target=dos_watcom --profile=release
# Or:
./legacy_build/dom_legacy --target=dos_watcom --profile=release
This will:
compile DOS engine
enforce SFN
call dpak builder for base_min.dpak
produce /build_legacy/dos_watcom/bin/DOM.EXE
generate SFN mapping

10. SUMMARY
Volume 6.9 defines:
Hybrid build system:
CMake for all modern platforms.
Custom Legacy Orchestrator for DOS/Win1‚Äì3/Win9x/NT3/console-grade targets.
Unified dpak builder used by both strata.
Packaging tools that consume build outputs and dpaks to produce:
digital downloads
Steam/GOG depots
physical disc images
DOS SFN distributions
Reproducible, version-pinned builds.
Clear requirements for C89/C++98 compliance across all targets.
Clean separation of build products:
build/
build_legacy/
dist/.
This concludes the build and toolchain integration layer and closes out the 6.x ‚ÄúDistribution & Execution‚Äù block.
END OF VOLUME 6.9
