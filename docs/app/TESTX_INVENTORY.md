# TESTX Inventory (APR0 Discovery)

Short discovery summary for the APR0 platform/runtime and renderer work.

## Targets (CMake)
- Client: `dominium_client` -> `client` (`client/CMakeLists.txt`).
- Server: `dominium_server` -> `server` (`server/CMakeLists.txt`).
- Launcher: `launcher_cli` -> `launcher`, plus `launcher_gui`, `launcher_tui` (`launcher/CMakeLists.txt`).
- Setup: `setup_cli` -> `setup`, plus `setup_gui`, `setup_tui` (`setup/CMakeLists.txt`).
- Tools: `dominium-tools` -> `tools`, plus `coredata_compile`, `coredata_validate`, `data_validate`, `validate_all`, `mod_pack_builder`, `mod_pack_validator` (`tools/CMakeLists.txt`).
- Engine/game tests live under `engine/tests` and `game/tests` with many add_test entries.

## Tests (ctest / TESTX)
- Test presets are defined in `CMakePresets.json` (debug, baseline, modern, platform-specific).
- Root CMake registers `launcher_help` and `setup_help` tests when those targets exist.
- Engine tests: `engine_smoke`, performance/IR tests (`engine/tests/CMakeLists.txt`).
- Game tests: many simulation/contract tests and `domino_core_smoke` (`game/tests/CMakeLists.txt`).
- Server tests: shard/integrity suites (`server/CMakeLists.txt`).
- Tools tests: validator fixture failures and content checks (`tools/CMakeLists.txt`).
- No explicit `TESTX` label or dedicated CLI smoke tests for client/server/tools found in ctest.

## CLI contracts (current)
- Client (`client/app/main_client.c`): `--build-info`, `--status`, `--control-*`, `--mp0-connect=local`; missing `--help`, `--version`, and a deterministic smoke/selftest mode.
- Server (`server/app/main_server.c`): `--build-info`, `--status`, `--control-*`, `--mp0-loopback`, `--mp0-server-auth`; missing `--help`, `--version`, and a deterministic smoke/selftest mode.
- Launcher CLI (`launcher/cli/launcher_cli_main.c`): `--help`, `--version`, `--build-info`, `--status`, `version` and `list-profiles` commands; build-info output lacks product/build metadata.
- Setup CLI (`setup/cli/setup_cli_main.c`): `--help`, `--version`, `--build-info`, `--status`, `status` command; build-info output lacks product/build metadata.
- Tools host (`tools/tools_host_main.c`): no CLI flags; other tools vary and are not aligned to a shared contract.

## Version/build reporting (current)
- Global build number: `.dominium_build_number` (read in root `CMakeLists.txt`).
- Build/version header: generated by `setup/packages/scripts/update_build_number.cmake`.
- Project semver: `DOM_PROJECT_SEMVER` in root `CMakeLists.txt` (default `0.0.0`).
- Product version macros: `libs/contracts/include/dom_contracts/version.h` (`DOMINIUM_*_VERSION`).
- Build info API: `engine/include/domino/build_info.h` + `engine/modules/core/dom_build_info.c` (build id, git hash, toolchain id).
- Current app outputs omit product version, build id, git hash, toolchain id, and API/ABI versions.

## Platform runtime interface (current)
- `engine/include/domino/sys.h` defines `dsys_*` API + versioned vtables and legacy `domino_sys_*`.
- `engine/modules/system/sys.c` implements `dsys` with a single compiled backend and a null fallback.
- Available: init/shutdown, window create/destroy, set mode/size, get size, native handle, event poll, raw input/IME, monotonic time, paths/fs/process.
- Extension mechanism: `dom_query_interface_fn` with DSYS_IID_* constants.
- Missing vs APR0 requirements: window show/hide, window state query, framebuffer size, DPI scale + DPI change event, last-error text.

## Renderer interface (current)
- `engine/include/domino/gfx.h` defines minimal DGFX IR API + vtable and legacy wrappers.
- `engine/render/d_gfx_caps_stub.c` is a stub; backend directories are empty.
- `engine/include/domino/caps.h` provides a registry/selection model, but DGFX registration is not implemented.
- `game/include/dominium/dom_rend.h` defines a game-facing renderer vtable with no implementation.
- Missing vs APR0 requirements: backend registry, availability checks with reason codes, explicit selection failure, null + software backends, documented selection policy.

## Missing items to implement in APR0
- Add `--help`/`--version` to client/server/tools host; add deterministic `--smoke`/`--status`/`--selftest` modes where absent.
- Print product version, engine/game versions, build number, build id, git hash, toolchain id, API/ABI/protocol versions in `--build-info`.
- Implement platform runtime gaps (window state/DPI/framebuffer size/error text) and document extensions.
- Implement DGFX backend registry + null/software backends, and wire selection policy (explicit failure, auto selection audit).
- Add CLI smoke/build-info/version tests in existing ctest structure for client/server/launcher/setup/tools.
- Add platform/render/app contract docs under `docs/`.
