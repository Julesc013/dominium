# TESTX Inventory (APR0 Discovery)

Short discovery summary for the APR0 platform/runtime and renderer work.

## Targets (CMake)
- Client: `dominium_client` -> `client` (`client/CMakeLists.txt`).
- Server: `dominium_server` -> `server` (`server/CMakeLists.txt`).
- Launcher: `launcher_cli` -> `launcher`, plus `launcher_gui`, `launcher_tui` (`launcher/CMakeLists.txt`).
- Setup: `setup_cli` -> `setup`, plus `setup_gui`, `setup_tui` (`setup/CMakeLists.txt`).
- Tools: `dominium-tools` -> `tools`, plus `coredata_compile`, `coredata_validate`, `data_validate`, `validate_all`, `mod_pack_builder`, `mod_pack_validator` (`tools/CMakeLists.txt`).
- Engine/game tests live under `engine/tests` and `game/tests` with many add_test entries.

## Tests (ctest / TESTX)
- Test presets are defined in `CMakePresets.json` (debug, baseline, modern, platform-specific).
- Root CMake registers `launcher_help` and `setup_help` tests when those targets exist.
- Engine tests: `engine_smoke`, performance/IR tests (`engine/tests/CMakeLists.txt`).
- Game tests: many simulation/contract tests and `domino_core_smoke` (`game/tests/CMakeLists.txt`).
- Server tests: shard/integrity suites (`server/CMakeLists.txt`).
- Tools tests: validator fixture failures and content checks (`tools/CMakeLists.txt`).
- No explicit `TESTX` label or dedicated CLI smoke tests for client/server/tools found in ctest.

## CLI contracts (current)
- Client (`client/app/main_client.c`): `--help`, `--version`, `--build-info`, `--status`, `--smoke`, `--selftest`, `--renderer`, `--control-*`, `--mp0-connect=local`.
- Server (`server/app/main_server.c`): `--help`, `--version`, `--build-info`, `--status`, `--smoke`, `--selftest`, `--control-*`, `--mp0-loopback`, `--mp0-server-auth`.
- Launcher CLI (`launcher/cli/launcher_cli_main.c`): `--help`, `--version`, `--build-info`, `--status`, `--smoke`, `--selftest`, `version` and `list-profiles` commands.
- Setup CLI (`setup/cli/setup_cli_main.c`): `--help`, `--version`, `--build-info`, `--status`, `--smoke`, `--selftest`, `version` and `status` commands.
- Tools host (`tools/tools_host_main.c`): `--help`, `--version`, `--build-info`, `--status`, `--smoke`, `--selftest`, plus `inspect`/`validate`/`replay` stubs.

## Version/build reporting (current)
- Global build number: `.dominium_build_number` (read in root `CMakeLists.txt`).
- Build/version header: generated by `setup/packages/scripts/update_build_number.cmake`.
- Project semver: `DOM_PROJECT_SEMVER` in root `CMakeLists.txt` (default `0.0.0`).
- Product version macros: `libs/contracts/include/dom_contracts/version.h` (`DOMINIUM_*_VERSION`).
- Build metadata macros: `domino/config_base.h` (build id, git hash, toolchain id).
- App `--build-info` output now includes product version, engine/game versions, build number/id, git hash, toolchain id, plus protocol/API/ABI versions.

## Platform runtime interface (current)
- `engine/include/domino/sys.h` defines `dsys_*` API + versioned vtables and legacy `domino_sys_*`.
- `engine/modules/system/sys.c` implements `dsys` with a single compiled backend and a null fallback.
- Available: init/shutdown, window create/destroy, set mode/size, show/hide, get size/state/framebuffer size, DPI scale, native handle, event poll, raw input/IME, monotonic time, paths/fs/process.
- Extension mechanism: `dom_query_interface_fn` plus `dsys_query_extension` with DSYS_IID_* constants and extension names.
- Error model: `dsys_last_error_code`/`dsys_last_error_text` implemented; optional extensions stubbed.

## Renderer interface (current)
- `engine/include/domino/gfx.h` defines minimal DGFX IR API + vtable and legacy wrappers.
- `engine/render/d_gfx.c` implements backend selection, IR tracing, and registry wiring.
- Backends: `soft` and optional `null`, with stubbed dx9/dx11/gl2/vk1/metal when enabled.
- `engine/include/domino/caps.h` registry is wired via `dom_dgfx_register_caps_backends`.
- `game/include/dominium/dom_rend.h` defines a game-facing renderer vtable with no implementation.
- Selection policy enforces explicit failure and auto-selection logging; interfaces documented under `docs/render/`.

## Missing items to implement in APR0
- Wire platform runtime + renderer selection into client windowed path (resizable window per OS backend).
- Add launcher capability probe output (platform + renderer availability).
- Add CLI smoke/build-info/version tests in existing ctest structure for client/server/launcher/setup/tools.
- Run ctest to validate TESTX alignment and document compliance results.
